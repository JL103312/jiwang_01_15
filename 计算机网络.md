# 第一章 概述
## 1.1 计算机网络在信息时代的作用
21世纪的一些重要特征就是** 数字化，网络化 信息化, **它是一个以**网络为核心**的信息时代
在此之前，有**三大类**大家很熟悉的网络 ： **电信网络 + 有线网络 + 计算机网络**
**电信网络						 **（主要用于提供电话，电报，传真等服务）
**有线网络						**（主要提供电视节目） 
**计算机网络					**（主要用于计算机之间的文件传输） ，
但是随着计算机网络的快速发展，其他两类网络都逐渐融入到了计算机网络之中，这就是所谓的“三网融合”。
20世纪90年代之后，以**Internet**为代表的计算机网络得到飞速发展，从最初的仅供美国人教
育使用到供全球使用的商用网络。
关于Internet的不同译文：

- 因特网        科学家们的音译出来的名字，但是很少被使用
- 互联网        Internet是由数量及大的各种计算机网络互连起来的而得名

注意：
**互联网** 和 **互连网 **虽然只有一字之差，但是区别却很大，所有互连网才构成了最终的互联网
互联网的两大特点 ： **连通性 + 共享性**
连通性 ：     就是指网络可以无视距离，快速便捷的进行信息的交换
共享性：     指的就是资源共享（软件共享，信息共享，硬件共享等等）
## 1.2互联网的概述
### 1.2.1网络概述
**网络**(计算机网络) ：  是由若干 **节点 **和链接在节点上的 **链路组成 **（网络中的节点可以是 计算机，集线器，交换机，路由器等）
**互连网**  ： 是指多个网络通过 **路由器 **再次连接起来形成一个更大的网络 （互连网是“网络的
网络”），习惯上我们通常用“一朵云”来表示互连网，而“云朵”上连接的电脑我们称之为“主
机”，多个云朵通过`路由器`进行连接，但是`路由器`是一种特殊的计算机，却不能称为“主机” 
**因特网**： 是指世界上**最大的互连网络**，**多个互连网**再次连接形成最终的**互联网**
注意：

- internet  (互联网或互连网)是一个**通用名词**，它泛指由多个计算机网络互连而成的网络。在这些网络之间的通信协议可以是任意的。
- Internet (因特网)则是一 个**专用名词**，它指当前全球最大的、开放的、由众多网络相互连接而成的特定计算机网络，它采用TCP/IP协议族作为通信的规则，其前身是美国的ARPANET。
### 1.2.2互联网发展的三个阶段
![image.png](https://cdn.nlark.com/yuque/0/2024/png/39240021/1704202767747-e7625ed9-648d-4188-ae4d-e20701aed37a.png#averageHue=%23efe8e8&clientId=u125a77c3-14a0-4&from=paste&height=343&id=u5c9a6f78&originHeight=643&originWidth=1582&originalType=binary&ratio=1.875&rotation=0&showTitle=false&size=517832&status=done&style=none&taskId=u6e42a3ea-ace7-4120-b9b8-ca02a6d7fb9&title=&width=843.7333333333333)
**互联网提供者（ISP**） 可以从互联网管理机构申请到一整块IP，然后铺设通信线路和架构一些
必要的设备（比如路由器）之后便可以实现网络通信了，普通用户想要进行网络通信则是向其缴纳
费用然后才可以通过isp进行网络通信，但是根据服务覆盖的面积大小和拥有的ip地址数不同，ISP
也被进行分类： **主干ISP + 地区ISP + 本地ISP**
**主干ISP**：   它是由几个专门的公司创建和维护，服务面积最大（一般是跨国际）速度最快，**互相可以通信**
**地区ISP**： 主干的下一级，可以通过主干进行连接
**本地ISP**： 直接给用户提供服务，它可以连到地区ISP（绝大多数），也可以连到主干ISP
为了更快更方便的进行信息交互，** 互联网交换点(IXP)**诞生，它能够**直接让两个地区ISP不经**
**主干ISP进行信息的交互**，并且多个IXP进行信息交互时都不收费，但是向高一级进行信息交互时候
需要缴纳一定费用。IXP的构造很复杂，一般是由一个或多个网络交换机组成，然后许多ISP再连接
到这些网路交换机的相关端口上。
万维网www(word wide we) 的广泛使用大大方便了非网络专业人员对网络的使用，成为了互联网增长的主要驱动力。
### 1.2.3互联网的标准化工作
互联网的标准化工作很重要，它对互联网发展的好坏有着绝对的影响，但是标准化的制定不能
太早(后续需要修改) 也不能太晚 (造成盲目的竞争)。因为互联网已不再被美国政府掌管，因此成立
了一个国际性组织 **互联网协会（Internet Society  w-ISOC）**互联网的标准化制定一个特点就
是：**面向公众，**它的所有文档都是以**RFC**（请求评论）文档保存在网络上，任何人都可以随意的提
出意见，它的制定流程大致分为三个阶段：** 互联网草案->建议标准->互联网标准**
流程图
![](https://cdn.nlark.com/yuque/0/2024/jpeg/39240021/1705132645808-670118f2-f9cc-42cb-8f8b-6b8290877b29.jpeg)
注意：

- 原来的制定流程是分为四个标准的（互联网草案->建议标准->草案标准->互联网标准），但是随着时代变迁，我们把第三个流程给剔除了
- 想要成为互联网标准是很难的，截至目前仅有STD92,也就意味着只有92个互联网标准
## 1.3互联网的组成
互联网的拓扑结构虽然很复杂，并且覆盖了全球，但是从其工作方式上来看可以大致的分为两大个模块 ：**边缘部分  + 核心部分**
### 1.3.1边缘部分
 由所有连接在互联网上的**主机**构成，这是**用户直接使用的部分**，用来进行通信和资源共享。这
里的主机可能有着不同的功能而又表现成不同的形式，比如可能是有一台电脑，一个手机，甚至一
个摄像头，当然他们之间的通信也有两大方式： **客户-服务器模式（c/s） +  对等模式（p2p）**

- 所谓的c/s模式就是指两个主机之间的通信需要有**一台特殊的主机（服务器）**转发 实现通信
- p2p模式则通信双方是对等的，直接通过网络进行通信

注意：

- 我们这里所说的通信都是要**借助网络的核心部分**
- 所谓的通信实际上是两个主机上的**进程**进行**的通信**
### 1.3.2核心部分     
由大量**网络和**连接网络的**路由器**构成，这部分**为边缘部分提供服务（提供连通性和交换），**在
整个核心部分中起到关键作用的就是**路由器，**他是一种特殊的计算机（但不能称为”主机“）是实
现“分组交换”的主要部件，其主要任务是转发收到的分组。
三种交换方式：**电路交换 + 报文交换 + 分组交换**
#### 电路交换： 
在电话问世不久后，人们发现想要通过电话进行任意通信，n个用户需要有电话线相互连接，
那么就需要 n(n-1)/2条线，但是如果实现世界的电话通信，这将是巨大的耗资，为此人们使用一个
中间件“交换机”，所有电话都连接在“交换机”上，这样只需要n条线即可，在远距离电话通信
的时候，只需要使用多个“交换机”即可，“交换机”之间的连接时专门的线路（**中继线，实际中**
**这种线路早已经数字化了**）这是所有用户共享的，电话连接到“交换机”上的线路是用户专有的（用户线）
流程：

1. 建立连接             (分配通信资源)
2. 通话                  (一直占用通信资源)
3. 释放连接            (归还通信资源)

但是，计算机上的通信往往是 **突发式** 的数据传送，如果采用电路交换，那么传输速率将会很低，因此比不适用于网络通信。
电话交换示意图
![image.png](https://cdn.nlark.com/yuque/0/2024/png/39240021/1704260498126-ab83c9aa-e62b-42fd-914b-2109a465e127.png#averageHue=%23f1f1f1&clientId=u63c58c68-c860-4&from=paste&height=178&id=uec67a8ad&originHeight=333&originWidth=1281&originalType=binary&ratio=1.875&rotation=0&showTitle=false&size=116470&status=done&style=stroke&taskId=u461e97aa-3baf-41fb-98e2-b5f9a55fa0e&title=&width=683.2)
#### 报文交换：	
所谓的报文交换，就是指在收到数据后**将整个数据**通过路由器转发到目的地址，然后接收方解析整个数据，进而实现双方通信，但是：**这种交换方式对路由器的存储空间有着极大的要求**，**而且传输延时也会比较大，所以现在基本不再使用。**
#### 分组交换：
主要采用**存储转发原理**，会把**整个待发送数据（又称“报文”）**拆分成**等长的数据段**，然后再每个数据段前
加上一些必要的首部（里面包含一些目的地址发送方等重要信息）后就构成了一个**分组**（又称“包”），然后通
过识别首部信息经过“路由器”的**存储转发，**最后到达目的地址，进而实现双方通信。
注意：

- "路由器"接收到分组数据后会**先进行存储**，然后通过检查分组首部进而**查表转发**
- “路由器”再进行转发的时候，可以动态的选择**较优的路线进行转发**，避免网络拥堵，**保证传输效率**
- 这中方分组交换不必在通信过程中占用整个线路的资源，传输效率更高**更适合网络通信**
- 但是通过路由器时候需要排队**可能造成一定时延，**此外分组交换携带首部也带来了**一定的额外开销**

整个过程中的角色和作用：
![image.png](https://cdn.nlark.com/yuque/0/2024/png/39240021/1704262416187-0d393175-7f91-4ba5-ae56-1ba7cbdf5877.png#averageHue=%23f7faf7&clientId=u63c58c68-c860-4&from=paste&height=204&id=u8c34f28b&originHeight=161&originWidth=491&originalType=binary&ratio=1.875&rotation=0&showTitle=false&size=52927&status=done&style=stroke&taskId=u9e334e32-2e7d-4042-8456-a97c1ddb770&title=&width=620.86669921875)
#### 交换方式对比
电路交换就好比是一条直连双方的管道，所有数据通过这条管道直接到达双方，**比较稳定，速**
**度也比较快**，但是同时也一直占有线路，**利用率低**，考虑网络通信的突发性，并不适合网络通信，
这个往往用于**语音通信。**
报文交换则是通过“路由器”的存储转发，一步步的到达通信双方，相比电路交换它不需要建
立直达的管道，线路**利用率提升**，但是因为它是整条数据转发，对“路由器“的**存储空间要求较**
**高，还需要额外的首部信息。**
分组交换是最适合网络通信的交换方式，它既不用建立通信管道，又不对”路由器“的存储空
间做要求，但是相应的转发也带来了**传输时延**，以及额外的”**首部“控制信息**，不过相比之下它还
是网络通信的**首先交换方式**
## 1.4计算机网络
### 1.4.1计算机网络定义
计算机网络并没有统一标准的定义，一般定义是：**主要有一些通用的，可编程的硬件相互连接**
**而成**，这些硬件并非只实现某一特定目的，这些可编程的硬件能支持多种不同类型的数据，并支持
广泛和日益增长的应用。

- 计算机网络所连接的硬件并不只限于计算机，手机，电视等都可以
- 计算机网络并不只限于传输数据，而是可以支持很多功能（甚至一些还未出现的功能）
### 1.4.2计算机网络类型
依据不同的划分规则，有着不同的分类。
**覆盖范围划分：**
**广域网 WAN**  : 有时也称为远程网，覆盖范围可达几十到几千公里，主要用于跨国家通信
**城域网 MAN **：覆盖范围再5-50KM，主要用于一个或多个城市的通信
**局域网 LAN** ： 覆盖范围大概在1Km以内，主要用于企业或校园
**个人网 PAN** ： 大概再10m内，主要是将个人设备连接起来
注意：
如果中央处理机之间的距离非常近（1m之内）我们称之为多处理机系统而不称为计算机网络
**网络使用者分：**
公用网：是指大型公司（电信网络或其他）出资构建用于群众，只要交纳费用既可以使用
专用网：某个部分为了满足一些功能而建造只服务于本单位的网络，比如，军队，铁路，银行
### 1.4.3计算机网络性能
#### 性能指标
性能指标可以从不同的方面来度量计算机网络的性能，常见的性能指标大致可以分成八个部分：**速率  + 带宽 + 吞吐量 +  时延  + 时延带宽积 +  往返时间RRT +   利用率**
##### 速率
**计算机中**的数据量单位都是 ”比特（b）“，也就是一个二进制的 0或者1，速率也就是单位
时间内传递比特的个数，常见容量单位：
1TB = 210GB = 220KB=230KB=240B= 240 * 8 b
注意：

- 计算机中的单位是以** 2**10**为进率**，但是厂商定义的单位确是以**1000为进率，**这也就导致一块标着250GB容量的硬盘再实际的计算机中只显示232.8GB  `(250*10^6*8)/(2^30)=232.8 ` 
- 其实 **1000 **和 **2**10**=1024**差距不大，有时候我们是可以混着用的。

常见速率单位
1Tb/s = 103Gb/s=106Mb/s=109kb/s=1012b/s
注意：

- **速率之间的单位是1000为进率**
- 速率的单位都**是b/s结尾**，而不是B/s结尾，如果是B结尾是需要进行换算的
- **b/s** 也可以写成**bps**    1 Mb/s = 1Mbps
##### 带宽
带宽有**两种不同的解释**，原本是用来指代**电话通信的频率范围**，往往是300Hz-3.4kHz, 但是应
用在网络通信中，就**表示网络在单位时间内能通过的"最高速率"**，这其实**和速率是同等单位的**，单
位也是b/s。在两种表述中，前者侧重频域，后者侧重时域，**但本质是相同的**，一条通信线路的带
宽越宽所能传输的"最高速率"也就越高。
##### 吞吐量
吞吐量表示在**单位时间内通过某个网络**(或信道、接口)**的数据量**，吞吐量被经常用于对现实世
界中的网络的一种测量，以便知道实际上到底有多少数据量能够通过网络。**吞吐量受网络的带宽或**
**额定速率的限制。**比如，虽然你的网络支持100Mb/s的带宽，也就意味着某个路由器的吞吐量是
100Mb/s,但是被10个用户使用，那么每个用户的**带宽**就变成了**10Mb/s。**
##### 时延
所谓时延是**指数据从网络的一端传递到另一端所需要的时间，**它大致可以由三个部分构成：
**发送时延 + 传播时延 + 处理时延**（处理时延 和 排队时延 统称为处理时延）

**发送时延**：
 是指**主机**发送数据到**路由器**的时间，由 **主机网卡速率 + 信道带宽 + 路由器接口速率 ** ，三者
共同决定（三者中最小的），因此要仔细地处理三者的协调，**主要侧重于主机内部，与信道长度无**
**关   数据长度/发送速率。**
**传播时延**：
主要是指电磁博在介质中传播耗费的时间，一般是  传播距离/介质速率，**主要在主机外部**

- 自由空间: 3x108m/s
- 铜线: 2.3x108m/s 
- 光纤: 2.0x108m/s

**处理时延**：
主要是指"路由器"处理所耗费的时间，由于不同的"路由器"性能不同很难计算出，一般会忽略不计。
注意：

- 具体那种时延占主导地位要根据情况进行分析，不能一味的凭感觉判断
- 我们所说的**高速链路并不是说传播速度快**，因为电磁波在介质中的传播速率是确定的，所谓的告诉链路只是发送速率更快，进而整体的时延更小，显得更高速
##### 时延带宽积
主要是指 **传播时延 **与 **带宽 **的乘积，数据意义：若**发送端连续发送数据，则在所发送的第一个**
**比特即将到达终点时，发送端就已经发送了时延带宽积个比特，**链路的时延带宽积又称为**以比特为**
**单位的链路长度。**
##### 往返时间RTT
在许多情况下，因特网上的信息不仅仅单方向传输，而是双向交互，我们有时很需要知道双向
交互一次所需的时间，这就是往返时间RTT。当发送方发送完所有数据后等待接收方的确认信号**从**
**源主机发送分组开始，直到源主机收到来自目的主机的确认分组为止，所需要的时间。**往返时延中
影响最大的一般是** 卫星通信**
> 比如：A主机向B主机发送100MB的数据，发送速率是100Mb/s，但是只有A收到了B的确认信息后才能继续发送数据，设RTT = 2 s   ，那么整过程中的实际发送数据就应该是：   
>   发送时间： 100*2^20*8/100*10^6 = 8.39s
>   实际时间 ： 8.39 + 2 = 10.39s
>   实际发送速率：  100*2^20*8/10.39 = 80.7 Mb/s
>   比100Mb/s还是要小不少的 


##### 利用率
利用率可以分为： **信道利用率**  (用来表示某信道有百分之几的时间是被利用的(有数据通过) + 
**网络利用率** (全网络的信道利用率的加权平均)
注意：

- 根据排队论，当某信道的利用率增大时，该信道引起的时延也会迅速增加，因此，信道利用率**并非越高越好**;
- 如果令D0表示网络空闲时的时延，D表示网络当前的时延，那么在适当的假定条件下，可以用下面的简单公式来表示D、Do和利用率U之间的关系:  D0/(1-u) = D
- 当**网络的利用率达到50%时，时延就要加倍**;**超过50%时，时延急剧增大**;**接近100%时，时延就趋于无穷大**;因此，一些拥有较大主干网的ISP通常会控制它们的**信道利用率不超过50%**。如果超过了，就要准备扩容，增大线路的带宽。
- 也不能使信道利用率太低，这会使宝贵的通信资源被白白浪费。应该使用一些机制，可以根据情况动态调整输入到网络中的通信量,使网络利用率保持在一个合理的范围内。
##### 丢包率
丢包率即分组丢失率，**是指在一定的时间范围内，传输过程中丢失的分组数量与总分组数量的**
**比率。**丢包率具体可分为接口丢包率、结点丢包率、链路丢包率、路径丢包率、网络丢包率等。普
通用户一般意识不到丢包。
分组丢失主要有两种情况:

- 分组在传输过程中**出现误码，被结点丢弃**;
- 分组到达一台**队列已满的分组交换机时被丢弃**; 在**通信量较大时就可能造成网络拥塞**。

因此，无**拥塞时路径丢包率为0，轻度拥塞时路径丢包率为1 %~4%，严重拥塞时路径丢包率为5%~15%**
#### 非性能指标
一般是指 **费用  质量  标准化  可靠性  可拓展性升级性  易于管理维护性**
## 1.5计算机网络体系结构
### 1.5.1网络体系结构的形成
**计算机网络是个非常复杂的系统**，为了使两台计算机能够通信，两个计算机系统**必须高度协调**
工作才行，而这种协调是相当复杂的，**因此提出了”分层“的概念**。早在最初的ARPANET设计时
就提出了分层的设计理念。**"分层"可将庞大而复杂的问题，转化为若干较小的局部问题，而这些较**
**小的局部问题就比较易于研究和处理。**早在1970年，IBM公司就宣布了自己的**"系统网络体系结构"**
**（SNA）**，之后不同的公司分别制定着自己的网络体系结构，没有统一的标准，这就导致不同公
司的产品之间的通信成为了一个难题，因此 **国际化标准组织ISO **设计了一个**"开放系统互联基本参考模型" OSI/RM，**但是后面当OSI标准制定出来时候，却被**TCP/IP体系模型**抢占先机，现在基
本所有的计算机网络都是TCP/IP体系结构，这就导致了 **法律上的国际标准是 OSI ** **实际上的国际标准 是TCP/IP**
**失败原因归纳为：**

- ** **OSI的专家间缺实际经验，它们在完成OSI标准时没有商业驱动力。
- OSI的协议实现起来过分复杂而且运行效率很低。
- OSI标准的制定周期太长，因而使得按OS标准生产的设备无法及时进入市场。
- OSI的层效分也不太合理，有些功能在多个层次中重复出现。
### 1.5.2协议与划分层次
通过前面解释我们已经知道，想要网络通信，就必须保证计算机的高度协同，都必须遵守一定
的规则和体系，**这些为进行网络中数据交换而建立的规则，标准或约定就被称为网络协议。**它主要
涉及三个方面 ： **语法 **（定义好信息格式）**语义**（定义好规则，说白了我发的信息你能知道我要
干啥）** 同步**（ 定义好时序关系），对于一些复杂的协议应该是”层次式“的，这样能带来很多优
点：**各层次之间独立复杂性降低  灵活性好 结构可分割 易于维护和实现   促进标准化工作。计算机**
**网络的各层**及其**协议的集合**就是**网络的体系结构。**
### 1.5.3五层协议的体系结构

![](https://cdn.nlark.com/yuque/0/2024/jpeg/39240021/1705133757096-3df71e65-6532-4449-80f5-d774fc9136b1.jpeg)
**物理层**
物理层上**所传输的数据单位是比特**，也就是说发送方发送0或者1 ，接收方应该收到的也是0或
者1，**因此物理层考虑到往往是用多大电压表示0和1**，以及接收方**如何识别出发送方的数据**，**此外**
**还要规定网线插头的引脚和引脚的连接方式。**
注意：

- 严格来说，**传输媒体并不属于物理层**

**数据链路层**
两台主机在一个网络上进行通信，**数据链路层的任务是在两个相邻结点间的线路上无差错**
**地传送以帧（frame）为单位的数据**。每一帧包括数据和必要的控制信息，控制信息能能够使
接收方检测有无出错，或者检错，这都是数据链路层的功能。
**网络层**
网络层主要解决**多个网络之间通过路由器**的通信，要选择合适的路由，使 发送方的运输层
所传下来的分组能够正确无误地按照地址找到目的站，并交付给目的方的运输层。其次**就是**
**路由表的生成，选择合适的路线通过路由转发数据   **(数据传输单位 **分组 | IP数据报**)
**运输层**
因为一台主机上可以同时运行着不同的进程(程序)，那么通过网络传输的**数据交付给哪一个进**
**程也是问题**，以及如果传输**数据不符合该进程的数据要求该怎么办**，这都是运输层的管辖范围，他
有着**复用和分用**的特点，主要使用的协议是 **"传输控制协议"TCP** (数据传输单位 TCP**报文段**) 和 **"用户协议数据报" UDP** (数据传输单位  **用户数据报**)
**应用层**
应用层是最高的层次，他的主要任务就是**通过应用进程之间的交互来完成数据的转换**，应用层
的协议有很多 ，比如 ： 域名系统DNS  万维网 HTTP  邮件系统 SMTP等

- OSI参考模型把**对等层次**之间的数据单位叫做 **协议数据单元 PDU**
### 1.5.4网络通信术语
**实体**       任何可发送或接收信息的 **硬件 **或 **软件进程**。
**对等实体    **收发双方**相同层次**中的**实体**。
**协议         **控制两个**对等实体**进行**逻辑通信**(并不存在，因为我们的通信时逐层的) 的 **规则的集合**。

- 计算机网络协议一定要考虑全面，否则可能造成处于实际情况下一直等待的情况

**服务        **在**协议的控制下**，两个对等实体间的逻辑通信使得本层能够向上一层提供服务。
注意：

- **协议是“水平的”**,**服务是“垂直的”**
- 实体看得见相邻下层所**提供的服务**,但并不知道实现**该服务的具体协议**、

**服务访问点SAP   **在同一系统中**相邻两层的实体交换信息的逻辑接口**，用于区分不同的服务类型。

- 数据链路层的服务访问点为  帧的“类型”字段。
- 网络层的服务访问点为IP数据报首部中的“协议字段”
- 运输层的服务访问点为“端口号'

**服务原语      上层使用下层所提供的服务必须通过与下层交换一些命令,**这些命令称为服务原语。
**协议数据单元PDU**          **两个主机**，**对等层实体**进行信息交换的数据单位
**服务数据单元SDU  **       **同一系统内**，**上下层之间**交换的数据包称为服务数据单元。

- 多个SDU可以合成为一个PDU;一个SDU也可划分为几个PDU
# 第二章 物理层
## 2.1物理层的基本概念
首先要强调的是物理层要考虑的是 怎样才能使连接在计算机上的传输媒体中的传输数据都是比
特流，而非考虑用什么样的传输媒体，现有的传输媒体种类有很多，物理层的作用就是**尽可能的屏**
**蔽掉这些硬件和通信手段的差异，**这样提供给“数据链路层”的数据就都是比特流了。**用于物理层**
**的“协议”叫做“物理规程”**。至此物理层的主要任务就是确定与传输媒体的接口有关的一些特性：

- **机械特性**     规定接口所用**接线器的尺寸，引脚数和排列，固定和锁定装置**等
- **电气特性**    指明在**接口电缆**上的**各线**出现的**电压范围**
- **功能特性 **   指明某条线**出现某一电平的电压意义**
- **过程特性**    指明对于不同功能可能出现时间的事件的**出现顺序**

注意：

- 数据在**计算机内部**一般是`并行` 传输，但是在**通信线路**上一般采用`串行`传输(出于成本考虑).
- 由于物理的**连接方式**有很多（点对点的连接，广播形式等等），**传输媒体**也很多（双绞线，电缆等）,所以**物理层的协议也有很多。**
## 2.2数据通信的基础知识
### 2.2.1数据通信的系统模型
首先一个数据通信系统可以依次分成三大模块: **源系统(发送端)**->**传输系统(传输网络)**->**目的**
**系统 (接收方)。**
源系统是可以分成两个模块的： **源点** (说白了就是计算机产生的bit) +  **发送器**(想要在传输系
统上传输，直接的bit流是不可行的，而是要将bit流通过一定的编码后使其能够在传输系统上传
输），**我们常见的发送器就是调制器**，只不过现在大多数的电脑**已经内置**，我们不经常见而已。
 	相应的**目的系统**也是同样的配置，**接收器(解调器) + 终点(bit流)**
通信的目的是 **传输消息 ， 数据 **是运送消息的实体(通常是用特定的方式去表示信息)，**信号**  
是数据的电气或电磁表现，而根据信号中的取值类型不同又可以分为两类：**模拟信号 + 数字信号**
**模拟信号**
又称**“连续信号”** ，表示消息的参数是连续不断地，比如常见的电话 麦克风 就是传输的模拟
信号。
**数字信号**
又称**“离散信号”** ，表示消息的参数是离散的，比如计算机的bit流是0和1 ，某一时刻只能是
0 或者1中的一个，没有连续可言。而信号中的不同状态我们称为**“码元”**,比如0 和1 都是码元
### 2.2.2信道与调制
#### 信道
一般情况下，我们使用“信道”来表示**某一方向**传输信息的媒体，一条通信线路往往包含着两条信道（接收信道  发送信道）。
通信的三种方式：

- 单向通信  **(单工通信) **               只有一个方向的通信      比如  广播
- 双向交替通信 **(半双工通信)**      双方不能同时通信          比如    对讲机
- 双向同时通信 ** (全双工通信)**     双方可以同时通信           比如   电话

注意：

- 这里还是建议使用  **单向通信 **等字眼 ，以避免有时候的歧义 （比如 单工电台并非单向通信） 
#### 调制
来源于源的信号(比如计算机的图片，歌曲等)称为**“基带信号”**，但是"基带信号"往往不符合
信道传输的标准，我们需要进行再次编码，这个过程称为**“调制”**，调制可分为两种：** 基带调制 **
**+ 带通调制**
##### 基带调制
仅仅对基带信号的**波形**进行转换，使之能够符合信道标准，变换后仍是 “基带信号”,运用于
计算机那就是将 **数字信号**  转换另一种** 数字信号 **，**我们更愿意称为 “编码”。**
**编码的方式**

- 不归零制         高电平是1   低电平是0     					   		 **不同步基本不用**
- 归零制            最后归零，找到零之后位于上侧表示1 下侧表示0   		 **自同步**
- **曼彻斯特编码**   下跳表示1(说明下面有值那自然本身是1)  上跳表示0(一样)    **局域网用**
- **差分曼彻斯特编码**   首尾不同是0   相同是1 
##### 带通调制
我们使用“载波”进行调制，把基带信号的频率搬到更高频段，并转换成为** 模拟信号** ，经过
调制后的信号叫做 “带通信号” ，这种调制称之为 **“带通调制”。**
常用的方法有 ： **调制振幅 ** **调制频率**  **调制相位** ，但是**频率与相位**往往是相互关联的，所以调
制其中一个即可，为了达到更高的传输速率，我们往往一次尽可能的调制多个，所以一般是多元制
调制**振幅相位 **我们称之为  **正交振幅调制 QAM**
### 2.2.3信道极限容量
数字信号在传输的过程中会受到各种“影响”，进而导致**失真**无法被解析出来(我们所谓失真
是指无法识别)，一般情况下，**码元的传输速率越大**，信号的**传输距离越远**，**噪声干扰越大**或传输
媒体**质量越差**，也就会越失真。一般情况下，影响失真的**两个主要因素是： 码元速率 + 信噪比。**
当接收端所收到的码元由于失去了码元之间的界限而无法被解析出来的这种现象被称为“**码间**
**串扰”**。 在1924年，奈奎斯特就已经推导出在 **带宽w**(Hz) 的信道上，码元的最高传输速率是 
**2w**(码元/秒), 如果超出此速度就会产生“码间串扰”。
注意：

- **码元传输速率**又称为**波特率**、**调制速率**、**波形速率**或**符号速率**。它与**比特率**有一定关系
   - 当1个码元只携带1比特的信息量时，则波特率(码元/秒)与比特率(比特/秒)在数值上是相等的
   - 当1个码元携带n比特的信息量时， 则波特率转换成比特率时,数值要乘以n
- **数据传输速率 = 码元速率 * 每个码元携带信息量   **  (log2)
- 实际的信道所能传输的最高码元速率，要明显低于奈氏准则**(理想条件)**给出的这个上限数值。
- 要提高**信息传输速率**(比特率)，就必须设法使每一个码元能携带更多个比特的信息量。这需要采用**多元制**

所谓的信噪比就是  信号的平均功率(S) / 噪声平均功率(N),但是大家都是使用分贝(dB)做单位，**所以公式是 ： 信噪比（dB） = 10 * lg（S/N）**
在1948年，香农成功推导出了信道的**极限传输速率** ：** C = 带宽 * log2（1 + S/N），**也就是
说**只要信道的传输速率低于极限传输速率**就一定能实现**无差错的传输**，但具体什么方式就需要探究
了。但是 一般情况下我们计算出的实际传输速率会小很多，这是因为还有许多其他干扰。
**对比奈氏准则和香农公式的意义**,首先要明确 **实际数据传输速率 =  码元速率 * 码元携带信息**
**量**，奈氏准则说明了在带宽为 w 的信道上，码元的极限速率已经定了，进而**想要提高数据传输速**
**率你只能提升码元携带信息量**（就是探寻更厉害的技术），而香农公式则则是计算出了极限的数据
传输速率，**只要你的实际速率不高于极限那就一定可以完成正常通信。**
## 2.3物理层下的传输媒体
首先，**传输媒体不属于物理层**，它是物理层的下一层。传输媒体又被称为传输介质或者传输媒
介，说**白了就是数据在接收方和发送方之间的物理通路。**传输媒体又可以细分为两大类：**导引型传**
**输媒体  ** +**  非导引型传输媒体。**
### 2.3.1导引型传输媒体
导引型传输媒体中，电磁波 被 导引沿着 固体媒介(铜线或光纤) 传播。
#### 同轴电缆
同轴电缆是由 **导体铜芯(单股或多股) 绝缘层**  **网状**编制的**外导体屏蔽层** 和 **绝缘保护套** 构成，
由于**网状**编制的**外导体屏蔽层，使得它有一定的抗干扰性，**因此在**互联网的初期被广泛使用**，它的
带宽主要取决于**电缆的质量，**但是随着技术的进步，**同轴电缆已经不再适用于网络通信**，而是用在
有线电视上。 
缺点：同轴电缆**价格较贵**且**布线不够灵活和方便**，随着集线器的出现，在局域网领基本都是采用双
绞线作为传输媒体。

- **基带同轴电缆 ** (50电阻)    早期的 **局域网使用**
- **宽带同轴电缆 ** (75电阻)  **  **目前用于**有线电视**
#### 双绞线
双绞线又称为“双扭线”，**它是指将两根相互绝缘铜导线按照一定规则给纽合在一起。**纽合的
作用：既可以减少外界干扰 又减少了相邻导线的干扰，使用双绞线最多的就是电话系统线。现在通
常会将**一定数量的双绞线**捆成电缆在外面加上保护套，然后用于局域网线。**所有的双绞线都需要有**
**接地线，**双绞线的通信距离大概也就几公里，为此人们为了增强其通信能力又通过**增加纽合度**和**添**
**加电磁屏蔽的方法**来提升其通信能力，基于不同的增强方法又可以对其再次进行分类：
![](https://cdn.nlark.com/yuque/0/2024/jpeg/39240021/1704346807070-7d881ccb-a374-4204-806c-3d1c2cbff34b.jpeg)
#### 光纤
光纤通信其实就是利用光脉冲来进行通信，有光源信号相当于1没有则是相当于0，由于光的频
率非常高，因此光纤通信的**带宽很大**，**而且光纤很轻**，**保密性好，抗干扰能力强，**现在大多数网络
通信都是使**用光纤作为主力军**，光纤其实是由非常透明的石英玻璃拉成细丝，然后由**光纤芯**和**包层**
形成的双层通信圆柱体，光依靠在纤芯中的反射来前进，光纤又可以分为： **多模光纤  + 单模光**
**纤。**在实际中，我们往往会把多条甚至上百根光纤放在一起，然后增加强度做成**光缆**使用。
##### 多模光纤
可以存在多条不同角度入射的光纤在光芯中传播，但是随着距离的增加，光脉冲会逐渐拓宽最
后造成失真，因此**适用于近距离传输，对光源不做要求**可以使用便宜的发光二极管作光源
##### 单模光纤
如果我们把光纤芯的直径缩小到只能通过一条光纤，那么光脉冲就会沿着几乎直线传播而不会
失真，但是这种要求较高需要使用单独的**半导体激光器作光源。**
### 2.3.2非导引型传输媒体
有时候碍于地形，费用的阻力，我们可能无法去使用引导型媒体，此时就要考虑非引导型媒体
了，**非导引型传输媒体是指在密闭空间中无实质的固体媒介**，利用**电磁波进行通信**，但是并不是所
有的电磁波都能用来通信，我们用于通信的电磁波也就四种 ： **无线电波   微波    红外线   可见光**

- **无线电波**(30K-300M)主要适用于**广播  **
- **微波**(300M-300G) 这里有我们常用的2G-30G的**wifi技术** ** **
- **红外线 因为其穿透力若一般用于近距离的遥控**
- **可见光  现在还不怎么使用**

![](https://cdn.nlark.com/yuque/0/2024/jpeg/39240021/1705135288668-18392226-c99e-4fc0-806c-a5be8d34d8c7.jpeg)
## 2.4信道复用技术
复用(Multiplexing) 是通信技术中的一个重要概念。复用就是**通过一条物理线路同时传输多路**
**用户的信号**。当网络中传输媒体的传输容量大于多条单信道传输的总通信量时，可利用复用技术在
一条物理线路上建立多条通信信道来充分利用传输媒体的带宽。然后再接受双方分别使用“复用
器” 和 “分用器”即可完成正常网络通信。
注意：

- 这种**信道复用技术**其实往往不灵活一般**只用于无线网络**的物理层之中

示例图
![image.png](https://cdn.nlark.com/yuque/0/2024/png/39240021/1704359929594-1e6b7dbf-d42a-4c6a-9b7c-97bcd60c86ca.png#averageHue=%23f4f0ed&clientId=ucaab92e3-39dd-4&from=paste&height=199&id=u7a2b670b&originHeight=374&originWidth=1588&originalType=binary&ratio=1.875&rotation=0&showTitle=false&size=281944&status=done&style=stroke&taskId=ue08f85ea-6733-4235-8670-af29c3c7e86&title=&width=846.9333333333333)

- 可以有效减少物理线路的条数进而**节约经济**
- 但是如果物理条数比较少就会由于高速链路的价格和服用分用器的铺设 而**增加成本**
### 2.4.1频分复用 FDM
将传输线路的频带资源划分成多个子频带,**形成多个子信道**，每个子信道之间**设有隔离频带**以防
止相互干扰，当有多个信号输入复用器时候，复用器将各个信号**调制**到不同的频道上，使彼此不相
互干扰的共同使用线路 。** 所有用户同时占用不同的频带资源并行通信。**
倘若我们的接入用户不固定 **n**，那么我们的FDM就会被任意个(n)用户使用这种频分复用技术我们称为 **频分多址接入 FDMA**
![image.png](https://cdn.nlark.com/yuque/0/2024/png/39240021/1704360629232-9677e857-d507-4204-854d-3cd4fa059173.png#averageHue=%23f3b573&clientId=ucaab92e3-39dd-4&from=paste&height=185&id=u34caf9ac&originHeight=347&originWidth=1440&originalType=binary&ratio=1.875&rotation=0&showTitle=false&size=226589&status=done&style=none&taskId=uf6ef0fee-a700-4429-ae3b-ebc998113b1&title=&width=768)

### 2.4.2时分复用 TDM
将时间划分为一段段**等长**的**时分复用帧**。每一个用户在每一个时分复用帧中**占用固定序号**的**时隙，,** 每一个用户所占用的**时隙是周期性出现的**(其周期就是时分复用帧的长度。) **所有用户在不同的时间占用同样的频带宽度。**
倘若我们的接入用户不固定 n，那么我们的TDM就会被任意个(n)用户使用这种时分复用技术我们称为 **时分多址接入 TDMA**
由于网络通信的数据都是突发性的，所以TDM的模式会大大降低线路的利用率，因此对其改进
得出 **统计时分复用 STDM  ，**STDM通常配合 **集中器 **使用，集中器上连接用户，用户有了数据就
会发送到**集中器的缓存**中，然后集中器扫描缓存将其发送到STDM帧中，**STDM帧中的时隙小于用**
**户数，**一旦STDM帧满了会通过线路发送出去 ，但是STDM帧中的每个时隙还要额外的记录用户信
息，这也导致一些不必要的开销，但是相比TDM的效率底下我们还是能够接受的。

- STDM(集线器) 能正常工作的前提是并非所有用户不停的发送数据(那样就使用TDM技术了)

![image.png](https://cdn.nlark.com/yuque/0/2024/png/39240021/1704360879239-61645864-087d-495c-9af9-88627b74274f.png#averageHue=%23f7ab5a&clientId=ucaab92e3-39dd-4&from=paste&height=228&id=u97f66e57&originHeight=428&originWidth=1440&originalType=binary&ratio=1.875&rotation=0&showTitle=false&size=382605&status=done&style=none&taskId=ube95a190-1eba-4bb4-8272-83286936485&title=&width=768)

### 2.4.1波分复用 WDM
波分复用其实**就是光的频分复用**。由于光的频率很高，因此人们更习惯于用波长而非频率来描
述光，借鉴于电话的FDM,人们也研制出了波分复用，起初人们只能做到两路光的复用 WDM，就
来随着技术的发展人们已经实现几十路的光复用 “密集波复用 ”DWMD
注意：

- 由于光 在 长 距 离 传 播之后会逐渐 **衰减**，因此在 **光复用器 **和 **光分用器**之间   要带上 多个 **掺铒光纤放大器 EDFA   **

![image.png](https://cdn.nlark.com/yuque/0/2024/png/39240021/1704362836398-1384ed34-834b-4234-bdc9-957a9a5b5b45.png#averageHue=%23f6e5df&clientId=ucaab92e3-39dd-4&from=paste&height=257&id=u3ba0cc65&originHeight=481&originWidth=1420&originalType=binary&ratio=1.875&rotation=0&showTitle=false&size=375524&status=done&style=none&taskId=u48cc4f77-d7b8-44f4-aa6c-42cf147d1b5&title=&width=757.3333333333334)

### 2.4.1码分复用 CDM	
码分复用 CDM 实际上是**另一种共享信道的方法**，我们一般多使用 **码分多址技术CDMA** ，**你**
**可以理解为每个用户都有自己独特的id，所以在同一条信道上通信的时候不会冲突**，实际上这个id
被称为“码型”，每一个码型都是经过挑选的绝对不会重复 **（常采用伪随机码序列）**，现在的移动
设备一般都会配有CDMA设备以便于能够随时通信， 一般来说每一个CDMA在进行通信的时候会
被指派一个**m** bit的 **“码片序列”**(m一般取64 128 等)，那么用户在进行通信的时候如果要**发送比**
**特1** 就是发送**自身**的码片序列，如果要**发送比特0** 就是发送自身码片序列的**反码,  **那么现在如果要
发送数据率是 b bit/s,由于使用了CDMA技术 就要求发送数据率是** mb bit/s **这就要求频带宽度需
要拓宽m倍，这通信方式是 **扩频 **，          **直接序列扩频 DSSS**(就是上面的码片序列方式)   + 跳频扩频 FHSS 。
注意：

- CDMA系统的一个重要特点就是 ： **每个码片序列**不仅**不同**还要**正交 **
- **S * T =0    S * !S = -1  S * ! T = 0  S * S =1**
- 这样的话，A，B，C，D四个CMDA就可以实现通信，比如A发送1 B发送0 C不发送 ，那么此时D接收的就是A和B的**重叠信号**，然后D基于ABC的码片序列，与收到的信息做**规格化内积**，结果是1的表示发送数据1 结果是-1的表示发送数据0 结果是0的表示未发送数据
## 2.5数字传输系统
在**早期**的电话网中，从市局到用户之间主要采用的是廉价的**双绞线**，而**长途干线使用的是**
**FDM频分复用**的**模拟信号**传输，但是人们发现**数字信号**比模拟信号**优秀很多**所以更改了长途干线
方式为**TCM时分复用技术。**现在**光纤**的出现不仅适用于高速率业务(视频电话)又适用于低速率业务
(语音等)**已经基本取代了双绞线**。
过去的国际传输 由于 **速率不统一，时钟不同步** 而无法实现世界便捷通信，后来 每美国首先推
出了 **同步光纤网SONET** 规定了速率和时钟周期 随后又进行升级到 **同步数字系列 SDH  在SDH的**
**标准下第一次实现了全世界的便捷通信 。**
## 2.6宽带接入技术
过去的人们都是通过电话线接入本地的ISP获得IP后然后实现上网，但是这种速率极低(最大也
就56kb/s)后面随着技术发展，已经有多种宽带技术接入用户家中，对于“宽带”尚无统一定义，
依据最新定义是指上行速率达到25Mb/s 下行达到 3 Mb/s的接入技术。
 **ADSL    光纤同轴混合网 HFC     FFTx技术**
# 第三章 数据链路层
## 3.1基本概述
数据链路层属于计算机网络的低层，它所使用的信道主要有两种 ：** 点对点信道 + 广播信道,**它所面临的主要问题是 ：** 封装成帧  透明传输   差错检测**，它所使用的交互设备： **网桥，交换机 集**
**线器。**
### 3.1.1 数据链路和帧
所谓的**链路** 就是指从一个节点到相邻节点的**一段物理线路(有线和无线)**,而中间**没有经过任何的其他节点**，很明显计算机网络往往要经过许多这样的“链路”。
**数据链路** 则是指在链路上传输数据的时候不仅需要物理链路，还必须要有**一些通信协议**来
控制传输，若把这些硬件和软件都加到链路上就构成了“数据链路”。现在最简单的方法就是
使用**网络适配器 (既有软件又有硬件) **来实现数据链路层的功能，一般的适配器都包括**数据链路层**和**物理层。**
帧就是指数据链路层把上层 网络层 交付下来的 IP数据报 (前面和后面)添加一定的信息后构成的数据的那元就称之为** 帧。 **
### 3.1.2三大基本问题
**数据链路层的协议有很多种**，但是主要面临的问题基本一样 **封装成帧 透明传输 差错检测**
#### 封装成帧
封装成帧是指 在一段数据的**前后**分别 **添加帧头** 和 **帧尾** 使之成为帧。帧头和帧尾中包含
有重要的控制信息。帧头和帧尾的**作用之一**就是**帧定界**。我们可以在帧定界中使用一些特殊字
符来表示帧的开始和结束 这些字符就称为 **帧定界标志** 在发送帧的时候都是从帧头开始发送，
每一种链路层协议都规定了帧中数据部分长度的上限  **最大传送单元MTU**
注意：

- 并非所有的数据链路层**协议的帧定界中**都有 **帧定界标志，**比如以太网V2 则没有，它是依靠物理层添加的前导码来进行区分帧定界。
#### 透明传输
所谓的**透明传输**就是指，**无论怎么样你都能按照原样没有差错的接收数据**，就比如说:你要传输
的是文本数据(文本数据就是值从键盘中输入的数据), 那么你的数据只能是ASCII中的值，但是128
个ASCII码中仅有**95个是可以打印出来的**，**换句话说你的数据只能是95个字符中的组合**，那么我们
就可以用其余的33个不可打印的字符作为帧定界符，无论你的文本数据是什么我们都能按照原样无
差错的成功接收，但是倘若你的数据不是文本数据(图片，音频等)，那你就不能保证数据中不会出现33不可打印的字符，此时我们继续用帧定界符，就可能导致提前种植数据的接收，**这就不是透明**
**传输。**
为了解决这个问题我们采用的方法是  **字节填充**，如果我们在数据中提前碰到了帧定界符 那
我们就在**其前面插入 转义符**(相应的 如果是比特流，我们就插入转义比特流)，这样在接收方检测到
转义符后就知道此时并非帧定界符，而会按照普通数据接收此时的假定界符。
#### 差错检测
所谓** 比特差错** 是指 实际的通信链路都不是理想的，**比特在传输过程中可能会产生差错**(0->1 1->0) ** 比特差错只是传输差错的一种** 。
在一段时间内,传输错误的比特所占所有传输比特总数的比率称之为 **误码率 BER(bit error rate)**
BER**与信噪比关系很大**，因此一般传输要想办法降低信噪比。
用于差错检测的方法一般是  ：** 奇偶校验  + 循环冗余校验 CRC**
##### 奇偶校验 
在待发送的数据后面添加 **1位 奇偶校验位**,使整个数据(包括所添加的校验位在内)中**1的个数**
为**奇数(奇校验)或偶数(偶校验)。**
注意：

- 这种校验方法的漏检率很大(只能对一位bit变化检测出来)，因此一般**不适用网络通信**
##### 循环冗余校验 CRC
所谓的 循环冗余校验 其实就是对要发送的帧按照**一定的规则**重新生成后在发送，只不过这个规则可能有点复杂，不过我们**使用硬件实现**，速度还是很快的基本无影响，所以广泛应用在数据链路层。

1. 收发双方约定好一个**生成多项式G(x)**  (常用的有 **CRC-16  CRC-CCITT   CRC-32**)
2. 生成多项式G(x) 必须 包含** 最低次项**
3. 除数做的是  **亦或运算**
4. 发送方基于待发送的数据和生成多项式计算出 **冗余码 FCS (差错检测码)** , 将其添加到待传输数据的**后面**一起传输
5. 接收方通过生成多项式来计算收到的数据是否产生了误码;

计算流程
![image.png](https://cdn.nlark.com/yuque/0/2024/png/39240021/1704431040432-5e678797-6e1d-4cd7-9392-e557bb64b462.png#averageHue=%23fbc58f&clientId=ubb2f36f1-dd6f-4&from=paste&height=256&id=ucnKr&originHeight=480&originWidth=1489&originalType=binary&ratio=1.875&rotation=0&showTitle=false&size=258446&status=done&style=stroke&taskId=u7067b0d7-d62f-4906-8705-f38803c8bfa&title=&width=794.1333333333333)
示例
![image.png](https://cdn.nlark.com/yuque/0/2024/png/39240021/1704431514140-0544ffd7-3199-4392-8761-768ba5f1cb2b.png#averageHue=%23f6ece0&clientId=ubb2f36f1-dd6f-4&from=paste&height=394&id=u0dd83ded&originHeight=738&originWidth=1549&originalType=binary&ratio=1.875&rotation=0&showTitle=false&size=520323&status=done&style=stroke&taskId=ue7156155-ac91-4a49-8169-48a5e82174f&title=&width=826.1333333333333)
示例
![image.png](https://cdn.nlark.com/yuque/0/2024/png/39240021/1704431628202-8778b3ce-b905-4a27-bf7e-095fe4081029.png#averageHue=%23f4f2ef&clientId=ubb2f36f1-dd6f-4&from=paste&height=374&id=u3be04448&originHeight=701&originWidth=1555&originalType=binary&ratio=1.875&rotation=0&showTitle=false&size=466246&status=done&style=stroke&taskId=u0bb42270-bbe2-45e1-9a1a-89a547e301f&title=&width=829.3333333333334)
注意：

- **检错码**只能检测出帧在传输过程中**是否出现了差错**，但并不能定位错误，因此**无法纠正错误**。要想纠正传输中的差错，可以使用**冗余信息更多**的**纠错码进行前向纠错**。但**纠错码**的开销比较大，在计算机网络中**较少使用**。
- 循环冗余校验CRC有很好的检错能力**(漏检率非常低**)，虽然计算比较复杂，但非常易于用硬件实现，因此被**广泛应用于数据链路层。**
- 在计算机网络中通常采用我们后续课程中将要讨论的 **检错重传 **方式来纠正传输中的差错,或者仅仅是丢弃检测到差错的帧， **重传还是丢弃决于**数据链路层向其上层提供的是**可靠传输服务**还是**不可靠传输服务**。
- 目前的互联网通信往往对于不同的线路采用不同的对待方式，质量好的线路不使用重传和确认机制，质量不好的线路使用重传和确认机制。
## 3.2点对点 协议 PPP
### 3.2.1 协议概述
**点对点协议PPP**(Point-to-Point Protocol)是目前使用**最广泛**的点对点**数据链路层协议**，它也
是在**计算机和ISP**进行通信时所使用的**数据链路层协议，**PPP协议是因特网工程任务组IETF在1992
年制定的。经过1993年和1994年的修订,现在的PPP协议已成为因特网的正式标准。ppp协议的主
要功能就是接受一个帧，进行CRC检测，**它不需要纠错，不需要流量控制或者设置序号**，然后交付
到接收方即可，但是**它仅能应用在全双工链路上。**
### 3.2.2协议构成
ppp协议是由**三部分组成**：** 封装成帧**   **链路控制协议LCP  ** **网路控制协议NCP**

- 对各种协议数据报的封装方法     (封装成帧)
- **链路控制协议LCP**用于   **建立、配置 以及  测试数据链路的连接**
-  **一套网络控制协议NCPs，** 每一个协议支持不同的网络层协议(比如IP  DECnet  AppTalk等)
### 3.2.3三大问题解决方式
**帧格式示意图**
![image.png](https://cdn.nlark.com/yuque/0/2024/png/39240021/1704439425676-8d314d1a-6f8e-4deb-b350-d581ff7bd949.png#averageHue=%23f1e8dd&clientId=ubb2f36f1-dd6f-4&from=paste&height=396&id=u2e2c51ce&originHeight=743&originWidth=1508&originalType=binary&ratio=1.875&rotation=0&showTitle=false&size=488074&status=done&style=stroke&taskId=uf2486226-2090-4047-bc24-b7b29d14806&title=&width=804.2666666666667)

**透明传输示意图**
![image.png](https://cdn.nlark.com/yuque/0/2024/png/39240021/1704439670908-7edbac1e-7e2f-48aa-8bcc-5b0cb2432d97.png#averageHue=%23f3ece7&clientId=ubb2f36f1-dd6f-4&from=paste&height=393&id=ufab912a9&originHeight=737&originWidth=1476&originalType=binary&ratio=1.875&rotation=0&showTitle=false&size=557700&status=done&style=stroke&taskId=ua1ea6967-3f3c-4eb0-8afa-879b9c348ca&title=&width=787.2)
![image.png](https://cdn.nlark.com/yuque/0/2024/png/39240021/1704439730838-f5d3814c-adf2-49ba-a745-08bd672e6092.png#averageHue=%23f7ede7&clientId=ubb2f36f1-dd6f-4&from=paste&height=388&id=u469b442f&originHeight=728&originWidth=1538&originalType=binary&ratio=1.875&rotation=0&showTitle=false&size=515431&status=done&style=stroke&taskId=u07acdc00-a0d0-421c-8658-0a52b41919b&title=&width=820.2666666666667)

**差错检测示意图**
![image.png](https://cdn.nlark.com/yuque/0/2024/png/39240021/1704439925309-05806361-30c5-466b-a3a2-23c30577c401.png#averageHue=%23f3f5ef&clientId=ubb2f36f1-dd6f-4&from=paste&height=313&id=ua268f956&originHeight=587&originWidth=1436&originalType=binary&ratio=1.875&rotation=0&showTitle=false&size=582670&status=done&style=stroke&taskId=uce334f78-191b-4c73-bd0a-65fdb8a320c&title=&width=765.8666666666667)
### 3.2.3实际工作流程
当个人电脑想要通过ISP上网的时候，首先是个人电脑会向ISP发送一系列的LCP的分组,这些分
组中包含了一系列的配置参数，当鉴别成功之后，又会发送一些NCP的分组然后ISP会给个人电脑
分配一个临时IP用于上网通信。
![image.png](https://cdn.nlark.com/yuque/0/2024/png/39240021/1704441518675-71974346-ed8d-4d64-97ea-3a1f5046ed69.png#averageHue=%23f6f2f0&clientId=ubb2f36f1-dd6f-4&from=paste&height=397&id=u24f68c45&originHeight=744&originWidth=1545&originalType=binary&ratio=1.875&rotation=0&showTitle=false&size=356729&status=done&style=stroke&taskId=uc3eb960f-421d-4fa8-82a5-46c52264025&title=&width=824)
## 3.3广播信道的数据链路层
### 3.3.1局域网发展历程
**局域网** 的特点是** 网络为一个单位所拥有，并且地理范围和站点数码都比较有限，更方便管**
**理，由于范围小**，它可以**很方便去访问全“全网”**(这里指的是局域网自身的资源)，也可以进行**广**
**播**。根据局域网的**拓扑分类**可以把局域网分成： **总线形 + 环形  + 星形(连接到集线器)，**但是因为
共用网线，这就导致在进行数据通信的时候无法避免的会导致信息碰撞，解决方法可以分为两大
种：** 静态划分信道**(多用于无线网络)**  +  动态媒体介入控制 **(控制用户占用信道的时机 分为**两种**)
**随机接入** ： 用户**随意的发送数据**若是发生碰撞，则发送数据都失败
**受控接入**： 用户**不能随意发送数**据而是需要服从一定的控制   **(使用比较少)**
**以太网** 是美国施乐公司于1957年研制成功的一种**通信网络**，它甚至制定了以太网的一些**通信**
**标准(DIX v1   DIX v2)**,之后**被广泛应用于局域网中**，后来以太网在局域网中几乎垄断，   以至于
**以太网成为了局域网的代名词，**为了适应以太网的标准，OSI就把数据链路层给拆分而更加适合以
太网标准  **逻辑链路控制 LLC  +  媒体接入控制 MAC，**其中 **媒体接入控制MAC** 协议最为出名。
**网络适配器 ** ：其实就是计算机与外界局域网的连接工具，它其实是一块在(台式机)主机机箱中
的网络接口板  或 (笔记本)中的一块PCMCIA卡，有时又被称为 **“网卡”**，不过现在基本都是计算
机主板上**内嵌**很少见到单独的网卡了，**“网卡”有自己的 处理器 和 存储器** ，它能将通过网线传输
的**串行**数据给接收 并 通过 I/O总线 以**并行**的方式传输的cpu中(某种程度上来说它的作用就是实现
数据的串并转换来达到一个“适配”的功能)，有了网卡之后我们还需要在操作系统上安装 **“驱**
**动”**，**用来告诉适配器 和 cpu (发送| 接收)网络数据的存储位置,**它**接收数据(丢弃出错帧)**时候不需
cpu干涉，通过**中断**的方式来通知cpu读取数据。它主要工作在 **数据链路层和物理层。**
计算机的 **硬件地址 (MAC) **在 **适配器(网卡的ROM) **中 ，而**软件地址(IP)**在  **存储器**  中 。
### 3.3.2 CSMA/CD
#### CSMA/CD协议
早期的以太网主要使用“**总线**”形式，这样一旦一台计算机发送数据，就会以广播的形式到达
所有计算机上，**借助 适配器 的唯一地址**，人们通过在数据的首部 添加适配器的唯一地址 **来实现两**
**台计算机的数据通信**。由于以太网的小范围通信，**往往通信质量一般很好，**所以往往尽最大努力提
供**不可靠的 无连接** 的交付 ，至于出错帧是否需要重传，则是由其上层决定。因为以太网使用总线
型的通信方法，所以需要采取一定的措施来解决碰撞问题，以太网一般采用的是**载波监听多点接**
**入/碰撞检测 CSMA/CD** 协议 ** 来减少碰撞。以太网**传送的数据都是用曼彻斯特编码的信号，基于
其**中间必定出现电平转换**来很方便的**提取出来** **每一个 码元**。
**相关释义**
![image.png](https://cdn.nlark.com/yuque/0/2024/png/39240021/1704446672753-e91f345c-397d-4ec8-a21d-c1d5c526c5bb.png#averageHue=%23fbc78d&clientId=ubb2f36f1-dd6f-4&from=paste&height=314&id=u994a5b84&originHeight=588&originWidth=1573&originalType=binary&ratio=1.875&rotation=0&showTitle=false&size=552948&status=done&style=stroke&taskId=u323925d9-3f64-4f02-9fc0-f623694cdaf&title=&width=838.9333333333333)
#### 强化碰撞
![image.png](https://cdn.nlark.com/yuque/0/2024/png/39240021/1704448805518-60c8fcb0-3b67-4b39-99cd-4330b082c01a.png#averageHue=%23f6f9fa&clientId=ubb2f36f1-dd6f-4&from=paste&height=213&id=u27921221&originHeight=196&originWidth=588&originalType=binary&ratio=1.875&rotation=0&showTitle=false&size=228983&status=done&style=stroke&taskId=u9299c7ef-3fbf-469d-b8cf-ea5805d31c3&title=&width=639.6000366210938)
#### 争用期
主机最多经过2t 的时长就可检测到本次发送是否遭受了碰撞因此，以太网的**端到端往返传播时**
**延2t**称为  **争用期或碰撞窗口 **。**经过争用期这段时间还没有检测到碰撞，才能肯定这次发送不会发**
**生碰撞**。每一个主机在自己发送帧之后的一小段时间内，存在着遭遇碰撞的可能性。**这一小段时间**
**是不确定的**，它取决于另一个发送帧的主机到本主机的**距离**，但不会超过总线的端到端往返传播时
延，即一个争用期时间。显然，在以太网中** 发送帧的主机越多**, **端到端往返传播时延越大**，**发生碰**
**撞的概率就越大**。因此,共享式以太网不能连接太多的主机，使用的总线也不能太长。所以10Mb/s
的以太网把 争用期定为 **64B 512比特发送时间，即51.2μs**,  因此其总线长度**不能超过5120m**,但
考虑到其他一些因素,如信号衰减等，以太网规定总线长度不能超过2500m。
#### 退避算法
相应的如果发生了碰撞，就需要等待一定时机后在进行重新传输，而这个时机也是有一定的计
算规律的  **截断二进制指数退避  算法。**
示意图
![image.png](https://cdn.nlark.com/yuque/0/2024/png/39240021/1704447719080-7929293c-0885-47ff-9393-bb7d9aa05ec5.png#averageHue=%23eee4e0&clientId=ubb2f36f1-dd6f-4&from=paste&height=420&id=u5537089c&originHeight=788&originWidth=1562&originalType=binary&ratio=1.875&rotation=0&showTitle=false&size=604179&status=done&style=stroke&taskId=uc3a97875-ed51-4d76-9932-6cd7d1555c8&title=&width=833.0666666666667)
#### 最小帧长
因为只有在发送的时候才会检测碰撞，如果数据过短，发送完了后就停止检测，但是有可能在传输过程中刚好却发生碰撞，因此要限制**最小帧长64B**，不够的需要填补。
![image.png](https://cdn.nlark.com/yuque/0/2024/png/39240021/1704448174685-6d513a18-ac6e-48ae-8a2d-d6e597ea301f.png#averageHue=%23f1e7e5&clientId=ubb2f36f1-dd6f-4&from=paste&height=433&id=u6a561882&originHeight=812&originWidth=1441&originalType=binary&ratio=1.875&rotation=0&showTitle=false&size=601438&status=done&style=stroke&taskId=u6817f004-91c9-46c4-a9ed-eaa5e80e799&title=&width=768.5333333333333)
#### 最大帧长
虽然不会没有了最小帧长的那种担忧，但是过长的帧可能会导致接收方的缓存爆满，所以也要进行限制，一般是**不超过 1500B**
![image.png](https://cdn.nlark.com/yuque/0/2024/png/39240021/1704448396118-3db45da0-9a51-4b02-b69c-19f81838303e.png#averageHue=%23f7f4f1&clientId=ubb2f36f1-dd6f-4&from=paste&height=421&id=u2ea00882&originHeight=789&originWidth=1524&originalType=binary&ratio=1.875&rotation=0&showTitle=false&size=509886&status=done&style=stroke&taskId=u58cb1656-776f-4431-b8a1-8ffa7f6ba42&title=&width=812.8)
#### 信道利用率
![image.png](https://cdn.nlark.com/yuque/0/2024/png/39240021/1704449790262-64a9474c-15ef-4e46-b069-c8bf1757f813.png#averageHue=%23e5dedd&clientId=ubb2f36f1-dd6f-4&from=paste&height=420&id=u491de99c&originHeight=787&originWidth=1545&originalType=binary&ratio=1.875&rotation=0&showTitle=false&size=460816&status=done&style=stroke&taskId=u0c8b1f8c-1431-400a-94b4-9c56060c017&title=&width=824)
#### 使用集线器的星形拓扑
以太网 随着时代的发展 最后采用了灵活的**双绞线**，同时局域网的**连接形式**也由之前的 **总线形** 
发展成为了**使用 集线器 **的**星形。 **所谓的**集线器**HUB  **其实你可以理解称为一个很强的插座**(内部使
用大规模的芯片，可靠力很强)，**所有的主机都连接到上面**（此时要求**主机和集线器两端**使用 **RJ-**
**45 **插头 水晶头），这种使用了集线器的星形结构**在逻辑上**任然是一个**总线结构**，**任然需要使用**
**CSMA/CD 协议**来避免碰撞，但是**集线器自身**是**有一定的容错能力和管理能力的**，如果某个主机的
适配器发生故障不停的发送数据，集线器是可以检测到异常并断开内部连接的，这就大大的增强了
整个网络的出错能力，现在的堆叠式集线器一般由4-8个集线器堆叠构成他有着更强的网络管理能
力，给网络管理**带来了极大的方便。**
**注意：**

- **集线器工作在物理层**
- 一个集线器会有许多端口(8-16)，每个端口通过RJ-45插头与主机相连,**很像一个多端口转发器**
- 集线器还可以降低通信线路之间的干扰
- 集线器工作在物理层，他的每个端口仅简单的转发比特，不进行碰撞检测
- 使用集线器每个主机都需要**两对无屏蔽双绞 (放在一根电缆中)**线分别用于**接受**和**发送**信息
#### 以太网的MAC层
前面已经知道借用**适配器ROM中**的唯一**MAC地址**可以实现两台计算机的通信。一般来说MAC
是已经固化在适配器中，现在的**笔记本**一般都会有**两个适配器** 有线适配器 无线适配器，那么自然
也就会有两个MAC地址，**只有更换适配器之后才能改变MAC地址。现在已经规定MAC地址是由**
**6B (48字节)**构成 ，**前三字节(组织唯一标识符 OUI)**需要厂商向IEEE申请，而**后三位(拓展标识符**
**EUI)** 是厂商自己规定。
**MAC帧的发送顺序**是 ：第一字节 （b0-b7）->第六字节 （b0-b7），我们可以对发送的MAC帧分类 ： **单播帧** (一对一)  ** 广播帧**(一对全体 **保证MAC是 FF-FF-FF-FF**)  **多播帧**(一对多)
注意：

- 一般的**适配器**都能**识别 单播帧 **和 **广播帧**，**有的适配器**能够**识别多播帧(需要配置多播**)

![image.png](https://cdn.nlark.com/yuque/0/2024/png/39240021/1704459750301-81cd8c98-a302-480e-a831-d5b3c58af387.png#averageHue=%23f0eadb&clientId=ubb2f36f1-dd6f-4&from=paste&height=465&id=u7d614464&originHeight=871&originWidth=1535&originalType=binary&ratio=1.875&rotation=0&showTitle=false&size=651882&status=done&style=stroke&taskId=u1f593194-6a0b-4848-900e-8e36ed04279&title=&width=818.6666666666666)
## 3.4拓展的以太网
以太网广泛应用在局域网中，虽然稳定速度快，但是局域网的覆盖范围很有限，人们就考虑着将以太网进行范围拓展
### 3.4.1物理层拓展以太网
以太网上的主机距离不能太远(一般100m以内),否则信号就会衰减而无法使用CSMA/CD协
议，在过去人们主要使用 **转发器(可以理解为信号放大器) ** 来拓展以太网的覆盖范围，后来**双绞线 **
**电缆 和集线器HUB   **的出现**使得转发器很少使用**，来延长通信距离了。
### 3.4.2数据链路层拓展以太网
虽然在**物理层可以使用光纤 中继器 进行拓展**，不过**更有效的方式还是在数据链路层。**最初人
们使用的是 **网桥(它对收到的数据根据MAC地址通过相应的端口转发**) ，后来随着技术的发展，人
们又发明了 **交换式集线器 (以太网交换机SWITCH)**,**很快淘汰了网桥。**其实**交换机**的**实质**就是一个
**多端口**的**网桥，**它的**每一个端口**都**直接连接着计算机**，使得**多台主机**能够**同时**进行**(全双工)通信(网**
**桥一次分析一个帧**)，每个主机独占通信媒体，无碰撞的交换数据,**换句话说，每个端口到连接端口**
**的主机之间构成了一个碰撞域**，n个端口的交换机就有n给碰撞域。并且它的**端口还有存储功能**，可
以在输出端口繁忙时候进行缓存数据，它的储存转发表是逐步**自学习**建立起来的。有的交换机还具
有直通功能（基于硬件），可以不经储存而直接转发出去，不过可能会将一些无用帧(没有检错)给
发送出去。交换机**价格便宜**而且**功能强大**早已经**取代了网桥**。

- **交换机工作在数据链路层，不需要CSMA/CD协议**

交换机的**自学习能力**：交换机是一种即插即用的设备,，一开始它内部的交换表往往是空的，在
进行交换的过程中逐渐学习建立起来，具体流程是： A主机通过端口1发送数据到 B主机，当数据
通过端口1进入交换机时候，交换机会记录 端口1对应主机A，然后查表没有发现主机B对应的端
口，开始广播(当然不会广播端口1)，B主机通过端口2收到信息后知道这是传输给自己的数据，于
是就通过端口2回应广播，此时交换机就知道端口2对应主机B，以此类推，最后交换机可以记录所
有端口对应的主机。

- 交换表会有固定的时间清除 ，这是因为端口与主机的对应关系不是永久的

**交换机的生成树协议 STP** ： 有时多个交换机之间相互连接，这就可能导致传输的数据会在交
换机之间**以环形**来回传输，(俗称广播风暴)，耗费大量资源甚至造成网络拥塞，因此交换机一般都
具有生成树协议，在多个交换机相互交换一定的参数之后他们能够自动根据生成树协议计算并关闭
一定的端口以避免发送网路环路。
## 3.5虚拟局域网
前面已经说了，使用**交换机，集线器** 之后我们可以扩大以太网,但是这也带来了一定的弊端，当网络过于庞大之后，广播风暴  难以管理和维护潜在的安全问题等都会出现， 每一次的广播都会消耗大量网络资源，因此我们需要一种或新的技术来缩小广播范围，这就是**虚拟局域网 VLAN。**
**虚拟局域网VLAN(**Virtual Local Area Network)是一种将局域网内的设备划分成与物理位置无关的逻辑组的技术，这些逻辑组具有某些共同的需求。**它是由交换机实现的**。相比于普通的MAC帧，**VLAN的帧添加了四字节的VLAN标记**(此时称之为** IEEE 802.1Q帧**)**。**
![image.png](https://cdn.nlark.com/yuque/0/2024/png/39240021/1704514788187-09fbdeb8-8196-4d2e-a6cb-e872c97326b0.png#averageHue=%23eadeda&clientId=u1aad960c-a971-4&from=paste&height=330&id=u9253244f&originHeight=619&originWidth=1577&originalType=binary&ratio=1.875&rotation=0&showTitle=false&size=718274&status=done&style=stroke&taskId=u3d3042b7-7cea-466b-9e58-ba36a36c5e8&title=&width=841.0666666666667)
# 第四章 网络层
## 4.1网络层的提供的来两种服务
在计算机的网络领域，应该向上层提供什么什么样的服务一直被争论了很久，而当时的电信网
采用**面向连接的虚电路服务**，它的特点是是提供了可靠的服务，需要位通信双方建立起来一条逻辑
通路，这样当用户在发送数据的时候就不必再携带完整的目的地址，只需要标注简单的通路id即
可，**但是对电话机的要求很高，造价比较昂贵**。
而互联网的先驱者则是采用了一种新的思路，采用了**无连接的数据服务**，这种服务并不为上层
提供可靠的服务，(因为主机更智能一些，他们把纠错能力放在了上一层),但是这也让路由器的设计
比较简单造价低廉，后来**充分证明了这种思想的可行性.**
**对比**
![image.png](https://cdn.nlark.com/yuque/0/2024/png/39240021/1704524756532-bff6e75f-da59-4818-b868-e3895d7558ba.png#averageHue=%23dbdbdb&clientId=u1aad960c-a971-4&from=paste&height=265&id=ub3ed042d&originHeight=497&originWidth=1457&originalType=binary&ratio=1.875&rotation=0&showTitle=false&size=262767&status=done&style=stroke&taskId=ufc625a12-112c-4261-8175-7e4cd1e509f&title=&width=777.0666666666667)
其实通过学习过路由器的之后，你就会发现在路由器上传输的数据主要有两种：

- 转发源主机和目的主机之间传输的数据 (通过路由器之间的来回转发最后到达目的主机)
- 传送路由信息   （主要是依靠路由算法彼此不断的交换路由信息以便于构造路由表 ）
## 4.2网际协议 IP
### 4.2.1虚拟互联网络
我们知道**互联网** 是由 **数以百万的 互连网** 通过 **路由器** **连接而成**，如果我们想要 这些 **互连网**
**上的主机能够自由通信** ，碍于 **不同互连网使用的协议不一定相同**  想要实现通信**是很难的。**但是由
于OSI的计算机体系(基于 TCP/IP)的建立，使得**许多互连网**的**网络层** **都是使用IP协议**，这样我们把
这些使用**IP协议**的互连网 通过 **路由器 **连接起来 构成的一个大的网络 称为 **虚拟IP网 (又称为IP网)**
**注意：**

- 基于不同用户的需求不同，所以一般是**没有单一的网络能够适应全球用户的需求**，IP网络只是**最契合的而已**，这里还存在着许多其他网络
- 互联网 可以由许多种 异构的网络构成。
- 我们将数据再互联网上的每一次转发叫做 一**“跳”。**
### 4.2.4 IP地址
在TCP/IP体系中，IP地址是一一个最基本的概念,我们必须把它弄清楚。IPv4地址就是给因特网
上的每一台**主机(或路由器**)的每一个接口分配一个在**全世界范围内是唯一**的 **32比特 **的标识符。我
们一使用点分十进制来进行表示。
#### 分类IPv4
分类IPv4在2011年已经分配完毕，现在已经不在接收分配需求，在2017年 成功发布IPv6标准。我国也是在2014停止向新用户分配IPv4地址。
**IPv4格式**
![image.png](https://cdn.nlark.com/yuque/0/2024/png/39240021/1704528169570-eac77a14-1c18-4136-a252-5f9b5566bb89.png#averageHue=%23ede3da&clientId=u1aad960c-a971-4&from=paste&height=384&id=ud3ea74ac&originHeight=720&originWidth=1609&originalType=binary&ratio=1.875&rotation=0&showTitle=false&size=327072&status=done&style=stroke&taskId=u9f659324-69cd-4fe2-809e-267c0d60ca1&title=&width=858.1333333333333)
**A类**
![image.png](https://cdn.nlark.com/yuque/0/2024/png/39240021/1704528620412-14c13e22-bf1d-4c7e-80a1-14a734e0e2a4.png#averageHue=%23e6ddd5&clientId=u1aad960c-a971-4&from=paste&height=406&id=u0cd2516a&originHeight=761&originWidth=1606&originalType=binary&ratio=1.875&rotation=0&showTitle=false&size=585858&status=done&style=stroke&taskId=u844d9cb3-6e75-455b-825a-e305a9b6848&title=&width=856.5333333333333)
 B类
![image.png](https://cdn.nlark.com/yuque/0/2024/png/39240021/1704528805296-3ed592c6-260e-4068-9476-349e38fa7b97.png#averageHue=%23e9b444&clientId=u1aad960c-a971-4&from=paste&height=397&id=u42f34df4&originHeight=745&originWidth=1565&originalType=binary&ratio=1.875&rotation=0&showTitle=false&size=555535&status=done&style=stroke&taskId=ud9617be4-c590-4385-9128-d3aa237460e&title=&width=834.6666666666666)
**C类**
![image.png](https://cdn.nlark.com/yuque/0/2024/png/39240021/1704528891774-59b31df3-88ac-4f2b-b4b0-9ff4e3a74c32.png#averageHue=%23e8b347&clientId=u1aad960c-a971-4&from=paste&height=393&id=u69765659&originHeight=736&originWidth=1568&originalType=binary&ratio=1.875&rotation=0&showTitle=false&size=535152&status=done&style=stroke&taskId=u9c9ea266-3dd1-426c-bef0-c1a8c46e9ca&title=&width=836.2666666666667)
注意：

- **小于127**的为A类**(第一个字节)**   **128~191**的为B类**(前两个字节)**  1**92~223**的为C类**(三个字节)**
- **A类**网络号0和127                        不能指派
- 主机号为“全0”这是网络地址      不能指派
- 主机号为“全1”,这是广播地址    不能指派
#### 无分类IPv4
划分子网在一定程度上缓解了因特网在发展中遇到的困难，但是数量巨大的C类网因为其地址
空间太小并没有得到充分使用，整个IP地址仍在加速消耗，为此产生了 **无分类域间路由选择 CIDR**
CIDR使用“斜线记法”, 或称CIDR记法。即在**IPv4地址后面加上斜线**"/"，在斜线后面写上**网络前**
**缀所占的比特数量。**
我们把 **网络前缀都相同 **的所有**连续IP**地址称为** CIDR地址块**，根据地址块我们很容易计算出
这个地址块的详细内容。
![image.png](https://cdn.nlark.com/yuque/0/2024/png/39240021/1704531962456-dc4a1429-a395-4061-b615-f25f73c5c14c.png#averageHue=%23ece9e9&clientId=u1aad960c-a971-4&from=paste&height=401&id=k2s3I&originHeight=751&originWidth=1553&originalType=binary&ratio=1.875&rotation=0&showTitle=false&size=339867&status=done&style=stroke&taskId=uf7f7bb08-c6b4-4f29-affd-74b199441f0&title=&width=828.2666666666667)
反过来，当我们将一些**无分类地址**给**融合**成**一个地址**块的过程就叫做 **“构造超网(路由聚合）,**
这种方法在更新路由表的时候很有效果，只需要一条记录即可表示不同的网络。

- 网络前缀越长，地址块越小，路由越具体
- 若路由器查表转发分组时发现有多条路由可选，则选择网络前缀最长的那条，这称为最长前缀匹配，因为这样的路由更具体。

![image.png](https://cdn.nlark.com/yuque/0/2024/png/39240021/1704534304233-aefc69ea-d2a1-4330-a300-8a0b35236f00.png#averageHue=%23d1d5d0&clientId=u1aad960c-a971-4&from=paste&height=195&id=u5e301eef&originHeight=365&originWidth=1051&originalType=binary&ratio=1.875&rotation=0&showTitle=false&size=343407&status=done&style=stroke&taskId=u9d93c2e9-332e-488e-bdbd-82dcb13a6e4&title=&width=560.5333333333333)
#### 子网掩码
一个公司有一个局域网 A  (300台电脑)，很明显只能申请B类网络 ，但是一个B类网络支持的
主机数高达65000台电脑，于是该公司又增添电脑 同时为了防止所有电脑共用一个局域网难以管理
就又**新建两个局域网B C**，而**子网掩码(地址掩码)的作用就是分割之前的B类网络到三个不同的局域**
**网，32比特的子网掩码可以表明 分类IP地址的主机号部分被借用了几个比特 作为子网号。**

- **子网掩码**使用**连续的比特1**对应**网络号**和**子网号**
- **子网掩码**使用**连续的比特0**来对应**主机号**
- **IPv4地址**其相应的**子网掩码**进行**逻辑与运算**就可得到**IPv4地址所在子网的网络地址**

![image.png](https://cdn.nlark.com/yuque/0/2024/png/39240021/1704531113391-ba924a2c-2e15-49cf-9727-f4afe84e4d22.png#averageHue=%23f2b210&clientId=u1aad960c-a971-4&from=paste&height=410&id=KSKEh&originHeight=1305&originWidth=1609&originalType=binary&ratio=1.875&rotation=0&showTitle=false&size=1083057&status=done&style=stroke&taskId=udc6cc13c-6e70-47c8-bfc3-a0c6f73a45e&title=&width=505.53338623046875)
注意：

- 虽然划分子网可以很好的利用网络，但是我们也发现导致不能使用的ip增加了。



##### 定长子网掩码
定长的子网掩码一般对应着 分类 IPv4   ，使用**同一个**子网掩码 来划分子网每个子网所分配的
IP地址数量相同，可能会**造成IP地址的浪费。**
示例![image.png](https://cdn.nlark.com/yuque/0/2024/png/39240021/1704535787322-d0ef5d75-a2b0-49e9-a3cc-dce605d85898.png#averageHue=%23e8e3e3&clientId=u1aad960c-a971-4&from=paste&height=337&id=u826f6159&originHeight=632&originWidth=1621&originalType=binary&ratio=1.875&rotation=0&showTitle=false&size=730374&status=done&style=stroke&taskId=ud154e199-7cd5-497c-bc8d-3418af2a38f&title=&width=864.5333333333333)

- 此时一共五个网络需要划分，则需要 23=8>5  3位用于充当子网 而刚好每个子网30位恰好满足所有网络。
##### 变长子网掩码
使用**不同的子网掩码**来划分子网，每个子网所分配的IP地址数量可以不同，尽可能减少对IP地址的浪费
![image.png](https://cdn.nlark.com/yuque/0/2024/png/39240021/1704536487030-13b125fa-d53a-4172-bef8-e39811939d9c.png#averageHue=%23e6e1e1&clientId=u1aad960c-a971-4&from=paste&height=354&id=ucbbaffbf&originHeight=664&originWidth=1504&originalType=binary&ratio=1.875&rotation=0&showTitle=false&size=635473&status=done&style=stroke&taskId=u51e0e7f9-7e15-4efb-96d3-a6f5dea827d&title=&width=802.1333333333333)
### 4.2.3 IP地址与MAC地址
通过前面我们已经知道 MAC地址是被固化在网卡之中的，又被称为**硬件地址**，而**IP地址**则是
**软件地址**，它的主要作用就是用来区分 **网络号** 和 **主机号**。当用户进行**跨网络**传输数据的时候，**IP**
**数据报的 **首部中会封装着 **源IP地址  目的IP地址** ，然后在数据链路层再次进行封装，在**帧首部**中
包含着 **源MAC地址** **需要跳转的 路由器MAC地址**。换句话说 整个数据中的**IP**地址不会改变，但是
帧中的**MAC地址**却在路由器的传输过程中**不停的改变着。**

- 路由器 一般都有多个IP 地址 和MAC地址 ，而一般主机之后有一个IP和MAC地址。
### 4.2.4 地址解析协议 ARP
通过前面我们已经知道IP和MAC地址的关系，那么主机或者路由器**怎么知道在对帧封装时候应**
**该填入的下一个MAC地址呢？**这就涉及到一个新的协议 **地址解析协议 ARP**。由于IP(32bit)和
MAC(48bit)的**格式不同**外加**一些额外因素**(比如网卡更换)导致我们**无法提前定死它们之间映射**，所
以我们使用协议(软件算法)来动态 维护映射关系。
在每一个**主机上**都会有一个**ARP高速缓存表**，里面存有**该局域网的所有IP和MAC映射**。当源
主机要发送数据时候就会先查询该表，如果有目的地址的IP MAC映射 就会 在 **封装帧的时候写**
**入，**如果没有就会进行**广播** **"我的IP xxx MAC xxx 我想知道IP xxx的MAC地址"**，然后相应的目
的主机收到改广播之后就会在其主机上缓存 源主机的IP和MAC 然后进行一个**单播**相应 ，这样就通
过ARP实现了IP和MAC的映射。当然这个ARP缓存表也有一定的生存时间以避免”映射错误“。
注意：

- 动态:  自动获取，生命周期**默认为两分钟**;
- 静态:手工设置，**不同操作系统下的生命周期不同**。
- ARP协议只能在**一个网络**或**一段链路上使用**，对于跨网络数据我们是逐个链路上使用
### 4.2.5IP数据报格式
我们已经知道了IP的形式，接下来了解一下IP数据报 的格式
![image.png](https://cdn.nlark.com/yuque/0/2024/png/39240021/1704546692730-72af05b1-056e-48ce-9009-495ee96cd53e.png#averageHue=%23f5f2f2&clientId=uedaf7aa9-474a-4&from=paste&height=225&id=u59918091&originHeight=422&originWidth=1223&originalType=binary&ratio=1.875&rotation=0&showTitle=false&size=113741&status=done&style=stroke&taskId=u1752c5d4-9115-42bb-bcbd-52e3cb3ccac&title=&width=652.2666666666667)

- **版本： 4b **表示IP协议的版本,通信双方使用的**IP协议的版本必须一致。**
- **首部长度: **4b 表示IP数据报**首部的长度**(以4b为单位)**     **最小取5 最大 15
- **填充字段: **确保首部长度为**4字节的整数倍  **,  使用**全0**进行填充。
- **区分服务: **8b  用来获得更好的服务 只有在使用区分服务时，该字段才起作用(一般不用)
- **总长度：**16b  IP数据报的**总长度(首部+数据载荷)**   以B为单位
- **标识：** 16b   属于**同一个数据报**的个**分组**应该具有**相同的 标识**
- **标志：**  3b    0   1/0(有 无 分片)   1/0  （不可以/可以分片）
- **片偏移：** 13b   片偏移一般以8字节为单位
- **生存时间TTL**： 8b   用于**检测数据是否存活**，以**跳数**为单位    (目的防止循环)
- **协议 ：** 8b     用于指明**使用的何种协议单元**
- **首部检验和 ：** 16b  **检测传输中是否出错**，**IP提供不可靠服务 ,所以没有什么意义 已经不用**
### 4.2.6 IP数据报的发送转发过程
通过前面我们已经对IP数据报的格式有了基本的了解，接下来让我们看一看IP数据报是怎样在网络中传输的。
![image.png](https://cdn.nlark.com/yuque/0/2024/png/39240021/1704602539702-75556534-9a9a-4008-92e3-17cf502d62a7.png#averageHue=%23f6f3f2&clientId=u057f64fa-f87a-4&from=paste&height=355&id=u31a8050f&originHeight=666&originWidth=1522&originalType=binary&ratio=1.875&rotation=0&showTitle=false&size=442185&status=done&style=stroke&taskId=u77e9b507-386a-4263-abf0-ea9d0dc2ce8&title=&width=811.7333333333333)
如图所示 使用 路由器R 连接了两个网络S1 S2 ,然后每个网络都有三台主机，主机的IP地址和子网掩码也都给了出来，我们来看通信情况： 
A -> B 
这种通信是主机 A 向 主机B进行信息交互，但是 AB是在同一个网络上的，也就意味着它们之
间的通信**不需要经过路由器的转发(A怎么判断的呢) **： 当主机A在封装数据的时候 必然知道B主机
的IP地址 ，然后**用B 的 IP **与**A所在网络的子网掩码 **相**与AND** 操作 得出的结果发现就是A所在的
网络，**进而推测出B在本网络上**，可以直接发送   这就是 **直接交付。**
A - > D
这种通信AD不**在一个网络上就需要借助路由器**进行数据转发了。**判断过程：**同样主机A在封装
数据的时候 必然知道B主机的IP地址 ，然后**用B 的 IP **与**A所在网络的子网掩码 **相**与AND** 操作 发
现得出的结果并不是A所在的网络，证明目的地址不在该网络上，此时A就需要**把数据推送到默认**
**的路由器上 **(这个**默认的路由器叫做网关**),剩余操作就交给路由器完成，路由器先获取数据得到目的
IP然后将**目的IP**逐个与自身**路由表的子网掩码**相与AND 操作，如果得到结果是 对应的IP地址 ，就
代表找到了目的网络，然后调用**ARP协议**获取**MAC **进行**封装转发**数据即可，如果一直未找到目的
网络就报错并通知源主机 。

- 在经过路由器通信的时候 第一步应该是先判断 数据报是否有误，只有没有错误才会继续查找
- 整个过程中 **子网掩码MASK**起到关键作用，我们再来**回顾一下 MASK的性质。**它是指将一个网络的**网络部分 全为**1 **主机部分 全0**（**或者网络前缀全1** ) 得出来的。
- 那么**同一个网络**(或者网络块)的**子网掩码一定都一样** 
- 其次就是同一个**网络(**或者网络块) 与**MASK相与**的  **结果   **必然**还是该网络**

## 4.3网际控制报文 ICMP
**为了更好的发送IP数据报和提高交付成功的机会**，在网际层我们还会使用一种协议用来记录IP
数据报的发送转发状态，这就是 **网际控制报文ICMP**(Internet Control Message Proctrol)。它允
许主机或者路由器报告差错情况和提供有关异常情况的报告 ，**ICMP**被**封装在IP数据报**的**数据部分**
中。常见的ICMP报文可以分为两大类 ： **ICMP差错报文  +  ICMP询问报文**  这两类又可以继续细
分
### ICMP 差错报文
ICMP的标准在不断更新，所以**有些ICMP报文也已经不在使用** (比如 ： **“源点抑制报文”**)，
下面是一些常见的ICMP差错报文的类型。
#### 终点不可达
当**路由器或主机不能交付数据报时**，就向**源点发送终点不可达报文**。具体可再根据ICMP的代
码字段细分为**目的网络不可达**、**目的主机不可达、目的协议不可达**、**目的端口不可达**、目**的网络未**
**知**、**目的主机未知**等**13种错误。**
#### 源点抑制
当**路由器或主机**由于**拥塞而丢弃数据报**时，就**向源点**发送源点抑制报文,使源点知道应当把**数据报的发送速率放慢。**
#### 时间超过
当路由器收到一个目的IP地址**不是自己的IP数据报**，会将其生存时间**TTL字段的值减1**。若结
果不为0,则将该IP数据报转发出去;若结果为0,**丢弃该数据报并且向源点发送时间超过报文，**另外。
当终点在**预先规定的时间内不能收到一个数据报的全部数据报片时**，**丢弃已接受的数据并且向源点**
**发送时间超过报文。**
#### 参数问题
当路由器或目的主机收到IP数据报后,**根据其首部中**的**检验和字段**发现首部在**传输过程中出现了**
**误码**，**就丢弃该数据报，并向源点发送参数问题报文。**
#### 改变路由(重定向)
**路由器**把**改变路由报文发送给主机**，让主机知道**下次应将数据报发送给另外的路由器**(可通过更好的路由)。
以下情况不发送ICMP差错报文：

- 对**ICMP差错报告报文**不再发送ICMP差错报告报文
- 对第**一个分片的数据报片的所有后续数据报片**都不发送ICMP差错报告报文
- 对具有**多播地址的数据**报都不发送ICMP差错报告报文
- 对具有**特殊地址**(如127.0.0.0或0.0.0.0) 的**数据**报不发送ICMP差错报告报文
### ICMP询问报文
#### 回送请求和回答
ICMP回送请求报文是**由主机或路由器**向一个**特定的目的主机发出的询问**。收到此报文的主机
**必须**给源主机或路由器**发送ICMP回送回答报文**。这种询问报文**用来测试目的站是否可达**及**了解其**
**有关状态。**
#### 时间戳请求和回答
ICMP时间戳请求报文是请某个主机或路由器**回答当前的日期和时间**。在ICMP时间戳回答报文
中有一个32位的字段，其中写入的整数代表从1900年1月1日起到当前时刻一共有多少秒。
**常使用的应用**分组网间探测**PING**  (Packet InterNet Groper)
用来测试**主机或路由器间**的**连通性，**应用层直接使用**网际层的ICMP (没有通过运输层的TCP或UDP) ， **使用**ICMP回送请求和回答报文。**
**跟踪路由**   (traceroute)
用来测试IP数据报从源主机到达目的主机要经过哪些路由器  , 实现原理是 依次发送 TTL=1,2,3,4.... 的报文 通过 响应的时间超时报文 来获取 逐个路由信息
Windows版本  : 
tracert命令    **应用层直接使用网际层ICMP **  使用了**回送请求和回答报文** 和  **差错报告报文**
Unix版本   :
  traceroute命令   在运输层使用**UDP协议**     **仅使用ICMP差错报告报文**
## 4.4 路由
我们知道处于两个不同网络的主机通信必须通过 “路由器”的中转，路由器 其实就是一种特
殊的计算机，它内部有一张 **路由表** 存储了**大量网络之间对应关系**，而接下来我们要研究的就是**这**
**张“路由表”的产生过程**( 关于路由的一些协议)。
### 4.4.1  路由协议概述 
其实路由选择协议的核心就是“路由算法”，**就是要通过什么样的算法来获取到路由表中的各**
**数据。**我们对路由算法要求**不限于  简单**(要尽可能容易) **稳定**(质量高)，**高效**(耗时要短)，**最佳**(选择
路线要最佳)，**健壮**(保证能够成功找到目的网络)，**动态**(随时适应网络变化)。为此产生了两大种配
置路由的方法 ： **静态路由(手动 适用于小规模)  +  动态路由(自动  适用于互联网)。**
基于不同需求，路由协议是分层次的。首先可以先将互联网划分为许多小的 自治系统 AS，**所**
**谓自治系统 就是在其内部自己管理一些网络 IP地址和路由器。**然后基于这些AS ，我们就可以将路
由选择划分为两大类 ：** 内部网关协议 IGP**    +  **外部网关协议 EGP**
注意：

- IGP  和 EGP  **只是路由选择协议的分类名称，并不是真正的路由协议**
- 在互联网的早期，把**路由器称之为 “网关” GETWA** ,因此网关协议就是路由器之间的协议
- 早期 EGP下的具体实现协议就叫 EGP为了防止混淆，人们换一种实现方式 边界网关协议 BGP

### 4.4.2内部网关协议
#### RIP
**路由信息协议RIP **(Routing Information Protocol)  是内部网关协议IGP中**最先得到广泛使用**的协议**之一**。  它是基于UDP的
**工作原理：**

1. RIP要求 AS 内的 每个 **路由器 **都**要维护 从它自己到 AS内其他每一个直连网络的距离记录( 距离向量D-V)**(Distance-Vector) ) 
2. **定时(一般30s) 向相邻的路由交换信息**
3. RIP使用**跳数** (Hop Count)作为 **度量** (Me/tric)来衡量到达目的网络的**距离**。
4. 路由器到**直连网络**的距离**定义为1**。**非直连**网络的距离定义为所**经过**的**路由器数+1**。
5. 一条路径**最大距离为15 **，**等于16时表示不可达**。因此，**RIP只适用于小型互联网**。
6. RIP认为**好的路由**就是“**距离短”**的路由，也就是所通过路由器数量最少的路由(即使当前路线的带宽很小)。 
7. 当到达同一目的网络有多条“距离相等"的路由时，可以进行**等价负载均衡 **(就是将数据均分到不同链路上)
- RIP协议的三个要点：
   - 和谁交换信息      			**仅和相邻路由器交换信息**
   - 交换什么信息         			**自己的路由表**
   - 何时交换信息  				**周期性交换**(例如每30秒)

**更新规则：**
![image.png](https://cdn.nlark.com/yuque/0/2024/png/39240021/1704615954298-c94c6aab-1837-4ade-8b7e-b9d72e70634f.png#averageHue=%23f8f1f1&clientId=u93b07599-b33a-4&from=paste&height=339&id=uf292bd2b&originHeight=636&originWidth=1605&originalType=binary&ratio=1.875&rotation=0&showTitle=false&size=382176&status=done&style=stroke&taskId=u3b336fce-43b4-4f7d-ba05-b3d2110d537&title=&width=856)
注意：

- RIP 是被封装在 **UDP 报文中**
- **Rip  只适用于短距离的小型网络**
- 并非所有厂商都严格遵守此协议，有的厂商（思科）将 直连网络距离定义为 0 
- RIP存在“**坏消息传播得慢**”的问题  这是距离向量算法的一个固有问题
- 可以采取多种措施减少出现该问题的概率或减小该问题带来的危害。
   - 限制最大路径距离为15 (16表示不可达)
   - 当路由表**发生变化时就立即发送更新报文**(即“触发更新”) ,而不仅是周期性发送
   - 让路由器记录收到某特定路由信息的接口，而不让同一路由信息再通过此接口向反方向传送(即“水平分割”)
#### OSPF
**开放最短路径优先 OSPF**(Open Shortest Path First),是为克服RIP的缺点，在1989年开发出
来的。“开放”表明OSPF协议不是受某一家厂 商控制，而是公开发表的。“最短路径优先”是因
为使用了Dijkstra提出的最短路径算法SPF。OSPF是**基于链路状态**的，而不像RIP那样是基于距离
向量的。OSPF采用SPF算法计算路由，从算法上保证了不会产生路由环路。OSPF不限制网络规
模，更新效率高，收敛速度快。**链路状态是指本路由器都和哪些路由器相邻，以及相应链路的"代**
**价"(cost)。**
**工作原理**

- OSPF相邻路由器之间通过交互 问候(Hello)分组 ，建立和维护邻居关系。 ip中封装格式如下

![image.png](https://cdn.nlark.com/yuque/0/2024/png/39240021/1704622798512-d93503a3-3f90-4941-9133-e9d85a0a07d7.png#averageHue=%23d8d4b7&clientId=u93b07599-b33a-4&from=paste&height=43&id=u2d492ec9&originHeight=81&originWidth=588&originalType=binary&ratio=1.875&rotation=0&showTitle=false&size=59578&status=done&style=stroke&taskId=u8cc158bc-a920-4372-aaba-b38bfb89d58&title=&width=313.6)

- 发送周期**为10秒**，但若40秒还未收到来自邻居问候分组 ，则**视为不可达。(用于维护信息)**
- 使用OSPF的每个路由器都会产生**链路状态通告LSA**(Link State Advertisement)   内容：
   - **直连网络**的**链路状态信息**
   - **邻居路由器**的**链路状态信息**
- LSA  被封装在 **链路状态更新分组LSU **中，采用**洪泛法**(A发给相邻的B，B继续发个相邻的C，最后达到所有路由器都受到数)发送。**(一般30分钟| 链路发生改变时候 自动交换)**
- 使用OSPF的 路由器 都有一个 **链路状态数据库LSDB**,  **用于存储LSA。**
- 通过各路由器洪泛发送封**装有自己LSA的LSU分组**，各路由器的LSDB最终将达到一致。
- 使用OSPF的各路由器**基于LSDB**进行**最短路径优先SPF计算**，接口构建出到其他路由器的最短路径 (路由表)
- OSPF有以下**五种**分组类型
   - 类型1,**问候 分组(Hello)**    用来发现和维护邻居路由器的可达性。
   - 类型2,**数据库描述分组**(Database Description)向邻居路由器给出自己的链路状态数据库中的所有链路状态项目的摘要信息
   - 类型3,**链路状态请求分组 LSQ**(Link State Request)向**邻居路由器请求**发送某**些链路状态项目的详细信息。**
   - 类型4，**链路状态更新分组 LSU**(Link State Update) 路由器使用这种分组将其链路状态进行洪泛发送，即用洪泛法对全网更新链路状态。
   - 类型5，**链路状态确认分组LSA**(Link State Acknowledgment)这是对链路状态更新分组的确认分组。

**工作过程**
![image.png](https://cdn.nlark.com/yuque/0/2024/png/39240021/1704625233788-b4ebf240-075f-4978-9e73-10c136dbf3b4.png#averageHue=%2369bac2&clientId=u93b07599-b33a-4&from=paste&height=399&id=u81f71c71&originHeight=748&originWidth=1563&originalType=binary&ratio=1.875&rotation=0&showTitle=false&size=539422&status=done&style=stroke&taskId=uf6e9e2f5-3fd1-403c-9c7b-0e3ebc0e90f&title=&width=833.6)
同时，为了是OSPF能够**适应更大的网络**并且**减少广播范围**，它还对AS进行了更细致的划分
![image.png](https://cdn.nlark.com/yuque/0/2024/png/39240021/1704625649787-c8036fb5-c3bf-4b0f-b9b6-6642f6c5899d.png#averageHue=%23e9c049&clientId=u93b07599-b33a-4&from=paste&height=379&id=u9865c3c3&originHeight=711&originWidth=1532&originalType=binary&ratio=1.875&rotation=0&showTitle=false&size=790010&status=done&style=stroke&taskId=u9b3f75ea-a0e2-4a85-aed0-078650d2925&title=&width=817.0666666666667)
注意：

- **OSPF报文 **是被封装在 **IP数据报中**
### 4.4.3外部网关协议
#### BGP
我们已经知道 **内部网关协议就是 设法使分组在一个自治系统内尽可能有效地从源网络传输到**
**目的网络 **不需要考虑自治系统外部其他方面的策略，但是外部网关协议由于 每个AS的 **“代价”**定
义不同 和 **相关策略(**政治 安全等) 的**不同** 而**不能采用内部网关协议的思路 **，所以BGP只能是力求
寻找一条能够到达目的网络且**比较好的路由**(不能兜圈子),**而非要寻找一条最佳路由。**
**工作原理**

- 在配置BGP时，每个自治系统的管理员要选择至少一个路由器(边界路由器)作为该自治系统的**“BGP发言人"。**
- 然后通过 不同自治系统的 **BGP发言人 **进行 **路由信息 的交换**
- 首先**必须建立TCP连接**，端口号为**179  **在此TCP连接上 **交换 BGP报文** 以建立BGP会话
   - 使用TCP连接交换路由信息的两个BGP发言人，被称为**彼此的邻站** 或 **对等站**
   - 交换的路由信息 ( 比如  增加新的路由，或撤销过时的路由，以及报告出错的情况等)
- **BGP发言人**除了运行**BGP外**，还**必须运行**自己所在自治系统所使用的** IGP,** 例如OSPF或RIP
- 当BGP发言人互相交换了网络可达性的信息后，各BGP发言人就根据**所采用的策略**从收到的路由信息中**找出到达各自治系统的较好的路由**（也就是构造出树形结构、不**存在回路**的自治系统连通图）
- BGP-4有以下**四种**报文
   - **OPEN(打开)报文**:用来与**相邻**的另一个BGP发言人**建立关系**,使**通信初始化(只有初始时候使用)**
   - **UPDATE(更新)报文:**用来通告某-路由的信息，以及列出要撤销的多条路由。
   - **KEEPALIVE(保活)报文**:用来周期性地证实邻站的连通性。
   - **NOTIFICATION(通知)报文:**用来发送检测到的差错**。**

注意：

- **BGP报文**是被封装在 **TCP报文中的**
### 4.4.4 路由器
之所以把路由器放在 路由选择协议之后介绍主要是因为 路由器中的一些构造会用到路由选择
协议的术语 。 **路由器** 其实是一种**具有 多个输入输出端的专用计算机** ，**其任务就是 转发分组。**从
路由器的某个输入端收入的**分组**，**按照该分组要去的目的网络 **将其从**合适的端口转发出去**(或到下
一跳 路由器)。一般的路由器可以划分为两大部分 ： **路由选择部分 + 分组转发部分**
**路由选择部分**
路由选择部分又被叫做 "控制部分  控制局面 " 它的**核心构件**是 **路由选择处理机** ，其任务就是**根据选定的 路由选择协议 构建出 路由表，同时定期的向相邻路由器交换信息以便 维护路由表。**由软件构成。
**分组转发部分**
分组转发部分由两大部分构成 ： **交换结构 **和  **输出输入端口**  。   交换结构的作用就是根据 
交换表  将输入进来的分组 (继续封装之后)通过相应的输出端口 转发出去 。
注意：

- 路由表和转发表是不一样的，一般而言 路由表是由多个路由器交换信息而得出来的，**它只包含目的网络到下一跳的映射**，而**转发表则是由路由表得出的**，它包含**完成转发的所有信息**，(比如：一些输出端口MAC地址等）
- 路由表需要**对网络拓扑变化的计算最优化**  转发表的结构应当**使查找过程最优化**
- 每个端口都设有三层的结构(物理层 数据链路层 网络层)以便于处理分组
- 还有就是每一个端口一般我们都是设置的有一定的缓存空间的，以便调解转发速率
# 第五章 运输层
## 概述
**通过前面**介绍的 物理层 数据链路层 和网络层 已经解决了 将主机通过 异构网络互联起来所面
临的问题，实现了 **主机到主机的通信**，但实际上在计算机网络中进行 **通信的真正实体 **是位于通信
两端 **主机中的进程**。如何为**运行在不同主机上的应用进程提供直接的通信服务是运输层的任务**，运
输层协议又称为 **端到端协议**。运输层向高层用户屏蔽了下面网络核心的细节(如网络拓扑、所采用
的路由选择协议等)，它使应用进程看见的就好像是在两个运输层实体之间有一条端到端的逻辑通
信信道。根据应用需求的不同，因特网的运输层为应用层提供了两种不同的运输协议，即**面向连接**
**的TCP **和 **无连接的UDP **,这两种协议就是本章要讨论的主要内容。
注意：

- 运输层还有一定的**"复用"**(即是 被不同的应用使用) 和 **"分用"**(能为不同应用提供数据) 能力 
## 端口号
我们知道在单个**计算机中**(操作系统)使用 **进程标识符PID**  来标志不同的应用进程，但是考虑
到因特网上的计算机并不是使用统一的操作系统 ,不同的操作系统又使用着 不同格式进程标识符，
所以为了使运行**不同操作系统的计算机的应用进程之间能够进行网络通信**，就必须使用统一的方法
对TCP/IP体系的 应用进程进行标识 ，这就是 **端口号。**(当应用进程需要发送数据的时候就会把数
据发送到对应的端口号中，同样读取数据也会从此端口号中 ，这也就要求端口必须要**有一定的缓存**
**能力)。**端口号使用**16比特**表示，取值范围 0~65535。

- **熟知端口号**: 0~1023, IANA把这些端口号指派给了TCP/IP体系中最重要的一些应用协议，例如: FTP使用21/20，HTTP使用80, DNS使用53。
- **登记端口号**: 1024~49151, 为没有熟知端口号的应用程序使用。使用这类端口号必须在IANA按照规定的**手续登记**,以防止重复。例如: Microsoft RDP微软远程桌面使用的端口是3389。
- **短暂端口号**: 49152~65535, 留给客户进程选择暂时使用。当服务器进程收到客户进程的报文时，就知道了客户进程所使用的动态端口号。**通信结束后，这个端口号可供其他客户进程以后使用**

![image.png](https://cdn.nlark.com/yuque/0/2024/png/39240021/1704966766539-f39c3e2a-2986-43b5-b646-737c4e6b04aa.png#averageHue=%23ede2d8&clientId=u3584b6ba-183e-4&from=paste&height=333&id=uf6ff11fe&originHeight=624&originWidth=1600&originalType=binary&ratio=1.875&rotation=0&showTitle=false&size=497272&status=done&style=stroke&taskId=u3abef1bc-549a-421f-9ae3-130857a3995&title=&width=853.3333333333334)
## UDP
用户数据报协议 UDP(User Datagram Protocol)  的设计初衷就是**用于某些简单的模式**，所以
它的设计很简单 ，就只是在 IP数据报服务至上增加了 **复用分用** 和 **差错检测 **的功能。它的特点
是：**无连接的**(减小时延) +** 不可靠服务** + **面向报文的**(对上层交来的数据**直接封装 添加首部**) +** 支**
**持各种通信**(一对一 一对多 一堆对有)  +** 首部开销小**(仅有8字节)。
UDP报文段格式
![image.png](https://cdn.nlark.com/yuque/0/2024/png/39240021/1704972222118-1b1cab9a-9a11-44fc-94ae-c8869effcfff.png#averageHue=%23f9f5f0&clientId=u3584b6ba-183e-4&from=paste&height=357&id=uf34d8076&originHeight=398&originWidth=692&originalType=binary&ratio=1.875&rotation=0&showTitle=false&size=153015&status=done&style=stroke&taskId=ud0240fd6-6129-49ff-82d5-0f2940dbc4f&title=&width=621.0667114257812)
注意：

- **UDP数据报**由 **首部** 和 **数据部分**组成 
- 首部比较简单 只有8 个字节 源端口  目的端口  长度  检验和
- 当接收方发现 UDP数据报 有误的时候(比如端口不对 | 检验有误) 就会丢弃 并通过**ICMP** 发送端口不可达 个发送方。
## TCP
### 概述
传输控制协议TCP (Transmission Control Protocol) 是一个**非常复杂**的协议 ，它是**面向连接**
**的**(数据交换的时候需要先建立连接)，**  可靠的**(通过TCP传输的数据可靠，无误  意味着它会采用一
些措施保证可靠)  ，**端点的**(以 **IP和端口号 **组成的 **套接字**叫做** 端点**)  **面向字节流的**(TCP不保证接
收方收到的数据块和发送方的块一样大，但总数据一样)  **全双工**(TCP在接收方和发送发都设有缓
存) 的一种协议。
### TCP报文的格式
一个TCP报文段由首部和数据载荷两部分构成，TCP的全部功能都体现在它首部中各字段的作用，它的 首部格式 与 IP首部格式 类似。
![image.png](https://cdn.nlark.com/yuque/0/2024/png/39240021/1704977803671-c5c0c0b8-cbac-496c-88b4-3a0bcdfb50ed.png#averageHue=%23f7f4f4&clientId=uf7198eb3-1bd6-4&from=paste&height=253&id=ue0819777&originHeight=475&originWidth=1405&originalType=binary&ratio=1.875&rotation=0&showTitle=false&size=126437&status=done&style=stroke&taskId=u60e22399-dc3c-4524-8055-0cccb01a1c4&title=&width=749.3333333333334)

- **源端口**:     占16比特，写入源端口号,用来标识发送该TCP报文段的应用进程。
- **目的端口**: 占16比特,写入目的端口号，用来标识接收该TCP报文段的应用进程。
- **序号**:  占32比特，取值范围[0,232-1],序号增加到最后一个后，下一个序号就又回到0。它的作用是 **指出本TCP报文段数据载荷的第一个字节的序号**
- **确认号**: 占32比特，取值范围[0, 232-1],确认号增加到最后一个后,下一个确认号就又回到0。它的作用是 指出**期望**收到**对方下一个TCP报文段**的数据载荷**的第一个字节的序号**，同时也是对之前收到的所有数据的确认。**若确认号=n,则表明到序号n-1为止的所有数据都已正确接收，期望接收序号为n的数据。**
- **确认标志位ACK: **取值为1时 确认号字段才有效 ; 取值为0时确认号字段无效。TCP规定，**在连接建立后 **所有传送的TCP报文段都必须把** ACK置1。**
- **数据偏移**: 占4比特,并**以4字节为单位**。用来指出TCP报文段的数据载荷部分的起始处**距离TCP报文段的起始处有多远**。这个字段**实际上是指出了TCP报文段的首部长度**。
- **保留**: 占6比特，保留为今后使用，**但目前应置为0。**
- **窗口: **占16比特，以字节为单位。用于指出发送方的发送窗口大小，也就是说 是由接收方写入自己的接收窗口大小 回送个 发送方 ，发送发要根据接收方的窗口调节发送窗口的大小
- **校验和**:占16比特，检查范围包括TCP报文段的首部和数据载荷两部分。
- **同步标志位SYN**:  在TCP连接建立时用来同步序号  (使用时候置为1)。
- **终止标志位FIN**:   用来释放TCP连接 (使用时候置为1)。
- **复位标志位RST:  **用来复位TCP连接。**当RST=1时，表明TCP连接出现了异常，必须释放连接，然后再重新建立连接。**
- **推送标志位PSH:**接收方的TCP收到该标志位为1的报文段会**尽快上交应用进程,而不必等到接收缓存都填满后再向上交付。**
- **紧急标志位URG: **取值为1时紧急指针字段有效;取值为0时紧急指针字段无效。
- **紧急指针:   **占16比特，以字节为单位，用来指明紧急数据的长度。**当发送方有紧急数据时可将紧急数据插队到发送缓存的最前面，并立刻封装到一个TCP报文段中进行发送**。紧急指针会指出本报文段数据载荷部分包含了多长的紧急数据，紧急数据之后是普通数据。
- **选项 **： 用于一些额外的选项字段(比如 时间戳  窗口扩大选项等)
- **填充: **由于选项的长度可变，因此使用填充来确保报文段**首部能被4整除**(因为数据偏移字段，也就是首部长度字段，是以4字节为单位的)
### 可靠传输的工作原理
我们知道TCP发送的报文段是要交给IP层传送的，但是IP层并不保证可靠传输(就是说出错了ip
不管 会直接丢弃)，所以要想实现可靠通信 必须采取一定措施 来**让接收方的运输层收到的数据都是**
**正确的**(换句话说 就是 接收方可以让 不正确的数据得到重传) ，经过大量分析后发现 可靠传输的两
个特点就是 **传输信道不产生差错** 和 **双方都能及时处理数据** 即可 ，因此 我们只需要采取一些措施 
**让出错的数据得以重传**  和 **发送方能够根据接收方的接收速率合理调节发送速率 **即可。
#### 停止等待协议
这个协议的工作过程就是 ：每发送完一个分组 就需要停止发送等待来自目的主机的确认信息
只有收到确认信息之后才能继续发送下一个分组。 然后我们来**分析一下这种协议的可用性和优缺点**

1. 如果 无差错  那么很明显可以
2. 如果 分组信息出现错误(误码，接收方丢弃等)  是需要重新传输的 接收方不会回送确认信息 而发送方对每一个分组都设置了一个时间如果规定时间内未收到确认信息，就表示需要重新传输很明显这种情况也可以
3. 如果接后方回送的确认信息丢失 或者 确认信息迟到  发送方会误以为分组丢失而重复发送分组，但是介于TCP数据包的格式会有一个标识 用于确认每一个分组 接收方重复收到分组后会丢弃 并不影响   所以这种情况也可以 

通过情况分析我们发现通过使用这种 停止等待协议 可以实现可靠传输(因为所有数据都能够传
输到目的地)，**它的优点就是 实现简单   但是却点是 信道利用率太低 **（测试结果最大也就5.6%）
#### 连续ARQ协议
停止等待协议不适用于TCP中，因此**连续ARQ协议**诞生了。它是基于一个窗口发送的，也就是
说在**发送方会维护一个固定大小的 "窗口"** ，能够一次将窗口内的分组全部发送出去，而接收方只
需要对按序到达的**最后一个分组进行确认**，表示确认分组之前的所有分组都已经成功接收，这样
就大大提升了效率。但缺点是 **不能及时的反应已经接收的分组** (比如一次发送五个分组 在第三个
分组丢失 那么就必须把第三个以及之后的重传一次 即使第四第五已经成功接收)不过我们更看重
效率，所以还是能接受的 。
### 可靠传输的实现
通过上述的基本思想，我们是可以实现可靠传输的，下面就介绍一下真正在计算机中可靠传输
的过程。
#### 滑动窗口
TCP基于 **以字节为单位的滑动窗口 **来实现可靠传输，它的基本实现思路是： 在收发双方的端
口上都**有一定的缓存** ，当要发送数据的时候，上层就把数据发送到该缓存至中，然后在该缓存中会
有一个**固定大小**(可调节)的 **窗口 **，**发送方只能将窗口内的数据 按序发送** ，然后接收方 会将接收到
的数据放到自己的**接收缓存之中 (因为数据可能不是按序到达的)**， 并对接收到的数据按序发送确
认报文(该报文中同时会封装 **未收到的数据** ) 发送方收到确认报文之后 根据报文信息 将接收方所需
要的数据再次重新发送 ( 发送方**设有计时器 **如果规定时间未收到 确认报文 就会认为该数据丢失并
重新传松  ) 当接收方已经成功收到**有序的数据** 就会回送 **确认报文** ，发送方收到该确认报文就会将
已经被确认收到的数据**从缓存中删除** 然后继续读取 上层 的数据到缓存中，就这样依次发送数据就
能达到可靠传输。
![image.png](https://cdn.nlark.com/yuque/0/2024/png/39240021/1705031666954-7ae1b941-21bf-4a13-9834-6892463d99e7.png#averageHue=%23f4f2f2&clientId=u655cb77d-557f-4&from=paste&height=379&id=ud6e01245&originHeight=711&originWidth=1606&originalType=binary&ratio=1.875&rotation=0&showTitle=false&size=392750&status=done&style=stroke&taskId=ufe59471c-f1cf-41b9-905a-318c99f5d73&title=&width=856.5333333333333)
注意：

- 虽然发送方的发送窗口是**根据接收方的接收窗口设置的**，但在同一时刻，发送方的发送窗口**并不总是 **和接收方的接收窗口一样大（可能因为网络滞延还未来得及更新  |  网络拥塞发送方适当减小自己窗口）
- 对于**不按序到达的数据应如何处理，TCP并无明确规定**。
   - 如果接收方把不按序到达的数据一律丢弃, 那么接收窗口的管理将会比较简单，但这样做对网络资源的利用不利,因为发送方会重复传送较多的数据。
   - TCP通常对不按序到达的数据是先临时存放在接收窗口中， 等到字节流中所缺少的字节收到后，再按序交付上层的应用进程。
- TCP**要求接收方**必须有**累积确认**和**捎带确认**机制 以便于 **减小传输开销**。接收方可以在合适的时候发送确认，也可以在自己有数据要发送时把确认信息顺便捎带上。
   - 接收方不应过分推迟发送确认，否则会导致发送方**不必要的超时重传**，这反而浪费了网络的资源。TCP标准规定，确认推迟的时间不应超过0.5秒。若收到-连串具有最大长度的报文段，则必须每隔一个报文段就发送一个确认[RFC 1122]。
#### 超时重传
考虑到**网络带宽的不稳定性 外加上 重传确认的无法区分** 等各种因素 使得超时重传时间的选择
是**TCP最复杂的问题之一**，如果选的过小就会导致不必要的数据被重传网络负荷增大 ，若果选的过
大又会导致 网络空闲浪费资源。因此，我们对超时重传的时间规定也是取一个**最接近的预估值**。

- 假设 报文发送并受到确认信息的时间  **往返时延 RTT**  
- 那么 **加权往返时间 **就是** RTTs** = （1-a）* 旧的RTTs + a * 新的RTT     我们一般取 **a = 0.125如果是第一次传输 那么 RTTs = RTT**
- 而 **偏差加权平均值**  是** RTTd** = (1-b) * 旧的 RTTd   + b * abs(RTTs - 新的 RTT)   **b = 0.25**   **第一次传输 那么 RTTd = 0.5 RTT**
- 而** 超时重传时间** RTO  = RTTs    + 4 * RTTD	

上面计算的 超时重传时间 RTO  已经很好的说明了时间的设置，但是有时可能重传之后收到了
确认报文 由于是对这段报文的确认我们无法得出是对第一个报文还是第二个重传报文的确认，所以
又**人为规定 每重传 一次就把重传时间 置为 旧重传时间  的 2倍**。
#### 流量控制
一般来说，我们总是希望数据传输得更快一些。但如果发送方把数据发送得过快，接收方就
可能**来不及接收，这就会造成数据的丢失**。所谓流量控制(flow control)就是让发送方的发送速率
不要太快，要让接收方来得及接收。利用**滑动窗口机制(其实就是接收方在回送确认的时候告诉发送方自己的窗口还能接收多少) **可以很方便地在TCP连接上实现对发送方的流量控制。
![image.png](https://cdn.nlark.com/yuque/0/2024/png/39240021/1705037078401-b4d71ef0-8e6e-4b31-b085-e2f824b3a2c4.png#averageHue=%23f9f9f5&clientId=u655cb77d-557f-4&from=paste&height=402&id=u8d47405b&originHeight=753&originWidth=1539&originalType=binary&ratio=1.875&rotation=0&showTitle=false&size=1005100&status=done&style=stroke&taskId=u5452548c-1b9c-42ca-be0f-a7c6d2f5e2a&title=&width=820.8)
![image.png](https://cdn.nlark.com/yuque/0/2024/png/39240021/1705037246054-4d2a2583-37e4-49d1-b0f2-7c1f382d2a37.png#averageHue=%23edece9&clientId=u655cb77d-557f-4&from=paste&height=358&id=u41ca4ced&originHeight=671&originWidth=1610&originalType=binary&ratio=1.875&rotation=0&showTitle=false&size=760600&status=done&style=stroke&taskId=ued87e613-bde9-44d2-ad2c-2c8b768e5c3&title=&width=858.6666666666666)
#### 拥塞控制
在某段时间，若对网络中**某一资源的需求 超过了** 该资源**所能提供的可用部分**，网络性能就要
变坏。这种情况就叫做拥塞(congestion)。在计算机网络中的链路容量(即带宽)、交换结点中的缓
存和处理机等，都是网络的资源。若出现拥塞而不进行控制，整个网络的吞吐量将随输入负荷的增
大而下降，但是网络拥塞的控制并不是仅仅提升 资源供应能力(比如提升带宽) 就能实现的，它是一
个很复杂的动态问题。为此人们设计出来**四种**控制方法： **慢开始 拥塞避免 +  快重传 快恢复**
##### 慢开始和拥塞避免

- 发送方维护一个叫做 **拥塞窗口cwnd **的状态变量,其值**取决于网络的拥塞程度**，并且**动态变化。**
   - **cwnd的维护原则**: 没有出现拥塞,拥塞窗口就再增大一些;出现拥塞, 窗口减小一些
   - 判断出现网络拥塞的**依据**:没有按时收到应当到达的确认报文(即发生**超时重传**)
- 发送方将拥塞窗口作为发送窗口swnd, 即**swnd = cwnd.**
- 维护一个 **慢开始门限ssthresh **状态变量
   - 当cwnd < ssthresh时，使用**慢开始算法**;
   - 当cwnd > ssthresh时，停止使用慢开始算法而改用**拥塞避免**算法;
   - 当cwnd = ssthresh时，既可使用慢开始算法，也可使用拥塞避免算法。

![image.png](https://cdn.nlark.com/yuque/0/2024/png/39240021/1705042383294-6367c58d-2358-4863-8c0a-38d1d67da303.png#averageHue=%23f3e5dd&clientId=u655cb77d-557f-4&from=paste&height=301&id=u03a4b786&originHeight=565&originWidth=1642&originalType=binary&ratio=1.875&rotation=0&showTitle=false&size=454628&status=done&style=stroke&taskId=u59e4a288-79e2-4972-b7fc-a1320a53f49&title=&width=875.7333333333333)
注意：

- “慢开始”是指一开始向网络**注入的报文段少**,并**不是指拥塞窗口cwnd增长速度慢**;
- “拥塞避免"**并非指完全能够避免拥塞**，而是指在拥塞避免阶段将拥塞窗口控制为按线性规律增长，**使网络比较不容易出现拥塞**;
##### 快重传
慢开始和拥塞避免算法是1988年提出的TCP拥塞控制算法(**TCP Tahoe版本**) ，1990年又增加了两个新的拥塞控制算法(改进TCP的性能)，这就是**快重传和快恢复**(**TCP Reno版本**)。
有时，个别报文段会在网络中丢失，但实际上网络并未发生拥塞。 这将导致发送方**超时重传**,
并**误认为网络发生了拥塞**;发送方把拥塞窗口cwnd又设置为最小值1,并错误地启动慢开始算法，因
而**降低了传输效率**。采用**快重传**算法可以让发送方**尽早**知道发生了**个别报文段的丢失**。**所谓快重**
**传，就是使发送方尽快进行重传，而不是等超时重传计时器超时再重传**

1. 要求接收方不要等待自己发送数据时才进行捎带确认,而是要**立即发送确认**  
2. 即使收到了失序的报文段也要立即发出对已收到的报文段的**重复确认** 
3. 发送方一旦**收到3个连续的重复确认**，就将相应的报文段**立即重传**，而不是等该报文段的超时重传计时器超时再重传
4. 对于个别丢失的报文段，发送方不会出现超时重传，也就不会误认为出现了拥塞(进而降低拥塞窗口cwnd为1)。使用快重传可以使整个网络的吞吐量**提高约20%**

快重传示意图
![image.png](https://cdn.nlark.com/yuque/0/2024/png/39240021/1705042996509-836a79f0-e933-4d06-b71c-257402366043.png#averageHue=%23fafaf6&clientId=u655cb77d-557f-4&from=paste&height=214&id=uc6b86383&originHeight=402&originWidth=1117&originalType=binary&ratio=1.875&rotation=0&showTitle=false&size=375483&status=done&style=stroke&taskId=u7de8351c-e3c6-42a9-88dd-5f50d16173e&title=&width=595.7333333333333)
##### 快恢复

- 发送方一旦收到3个重复确认，就知道现在只是丢失了个别的报文段。于是不启动慢开始算法，而执行快恢复算法;
- 发送方将慢**开始门限ssthresh**值和拥**塞窗口cwnd**值全部调整为**当前窗口的一半**;开始执行**拥塞避免**算法。
- 有的快恢复实现是把开始时的**拥塞窗口cwnd**值再增大一些，比如等于新的ssthresh + 3。
   - 既然发送方收到3个重复的确认，就表明有3个数据报文段已经离开了网络;
   - 这3个报文段不再消耗网络资源而是停留在接收方的接收缓存中;
   - 可见现在网络中不是堆积了报文段而是减少了3个报文段。因此可以适当把拥塞窗口扩大些。

![image.png](https://cdn.nlark.com/yuque/0/2024/png/39240021/1705043534074-0b14f159-1c94-4b5c-aa8b-a805fc95ca17.png#averageHue=%23f4e4db&clientId=u655cb77d-557f-4&from=paste&height=348&id=u9fa704d5&originHeight=652&originWidth=1615&originalType=binary&ratio=1.875&rotation=0&showTitle=false&size=574281&status=done&style=stroke&taskId=u840d18df-16e3-4733-830b-88e08aa9bf7&title=&width=861.3333333333334)
注意：

-  拥塞窗口 cwnd   开始门限**  **ssthresh   接收窗口 rwnd  在实际的传输过程中发送方的发送窗口是   min（ cwnd，rwnd） 也就是说是由 拥塞窗口和 接收窗口中 较小者 决定 
   - 当 cwnd   < rwnd      则是  拥塞窗口cwnd  来限制着发送方的 发送窗口
   - 反之 cwnd >rwnd     则是  接收窗口 rwnd  来限制着发送方的 发送窗口
## 连接管理
TCP是**面向连接的协议**，它基于运输连接来传送TCP报文段，TCP运输连接的 **建立 和 释放**是每
一次面向连接的通信中必不可少的过程。TCP运输连接有以下**三个**阶段:  **建立TCP连接 ** + **数据传**
**送 ** +  **释放TCP连接**
**建立连接**
建立连接主要解决的问题 ： 使TCP双方能够确知对方的存在; 使TCP双方能够协商一些参数(如
最大窗口值、是否使用窗口扩大选项和时间戳选项以及服务质量等) ;使TCP双方能够对运输实体资
源(如缓存大小、连接表中的项目等)进行分配。建立连接的过程是通过双方**交互一些TCP报文段**，
而**建立连接的过程又被叫做"握手"  ，需要通过三次握手来建立连接。**
三握手示意图
![image.png](https://cdn.nlark.com/yuque/0/2024/png/39240021/1705045596229-13dcd817-ef01-412e-956d-88054f401954.png#averageHue=%23ede6e6&clientId=u655cb77d-557f-4&from=paste&height=374&id=u1daf464d&originHeight=702&originWidth=1663&originalType=binary&ratio=1.875&rotation=0&showTitle=false&size=498198&status=done&style=stroke&taskId=u6a78accc-edd7-4c57-aa9e-f7e9c54ede1&title=&width=886.9333333333333)
注意：

- 之所以 会有第三次的客户端 确认数据 是为了防止浪费资源  比如 可能某次连接请求因为带宽问题导致被超时传输 当此次连接完成之后  ，这个请求终于到达被服务器 那么服务器就误以为再次连接 ，如果没有 客户机的确认连接  就会白白的浪费网络通信资源。

**释放连接**
TCP连接是双向的，客户端需要发送关闭请求，然后服务端回送确认关闭报文  相同的 服务端
也要两次报文交互 ，所以 一共需要四次 交互  ，又被称为** 四报文挥手**关闭连接**。**
![image.png](https://cdn.nlark.com/yuque/0/2024/png/39240021/1705047916107-f61746e3-69b8-4f20-b5a2-4ac0e16193df.png#averageHue=%23f7f5f1&clientId=u655cb77d-557f-4&from=paste&height=362&id=u6addbc8b&originHeight=679&originWidth=1672&originalType=binary&ratio=1.875&rotation=0&showTitle=false&size=588530&status=done&style=stroke&taskId=uef5b69f4-7762-42cc-96cb-3fd011a3917&title=&width=891.7333333333333)
注意：

- MSL(Maximum Segment Lifetime)意思是最长报文段寿命 建议为2分钟 但是现在网络速度很快可以选择更小的时间
- MSL的设置也是 为了 防止 客户机发送的关闭请求 丢失而无法收到响应  还可以保证网络中来自发送端的所有数据报都 无效(以免影响下次连接)
- 每建立一次TCP连接都会维护一个 **保活计时器**(2小时)  用于保证突发情况
   - 若保活计时器定时周期内未收到TCP客户进程发来的数据，则当保活计时器到时后，TCP服务进程就向TCP客户进程发送一个探测报文段，以后则每隔75秒钟发送一次。若一连发送10个探测报文段后仍无TCP客户进程的响应，TCP服务器进程就认为TCP客户进程所在主机出了故障,接着就关闭这个连接。
# 第六章  应用层
前面我们已经说明了通过计算机网络传输数据的过程 ，但是有了**通过网络传递的数据**之后并
不意味着就结束了，我们**还需要将数据给放到应用之中 显示出来**，(当然不同的应用对应的转换协
议肯定也不同,也就是说每一个应用协议都是为了某一类的应用问题)，这便是应用层的功能。

- 互联网的公共领域的标准应用协议是**由RFC规定的**，有公用的(HTTP)  当然也有私用的(P2P)
- 应用层**协议**只是**网络应用**的 **一部分** 比如万维网是一种基于客户/服务器的网络应用，它包括许多部件 万维网服务器 万维网浏览器 ，它的应用协议是HTTP。
## 6.1 域名 DNS
 	域名系统(Domain Name System ) DNS 是互联网使用的命名系统。我们知道网络上的**主机**
**想要进行信息交互**就**必须知道**相应的**IP地址**，但是**考虑到IP地址的难以记忆**，为此便产生了 **域名系**
**统 DNS** 能够将 **主机名 **给**转换成IP地址。**由于互联网上的主机数量庞大，因此单个的域名解析服
务器是无法满足需求的。早在1983年，因特网就开始采用 **层次结构的命名树 **作为 **主机的名字(域**
**名) **并使用 **分布式 **的**域名系统DNS ，**它是基于 UDP的。

- 分布式解决了  请求庞大的问题(同时避免了因为一台服务器宕机而导致整个网络无法使用)
- 层次结构的 命名形式 使得** DNS解析时候的 高效** 
- DNS使大多数域名都在**本地解析**，仅少量解析需要在因特网上通信，因此系统**效率很高**。
### 域名结构
域名的结构**由若干个分量组成**，各分量之间用“点”隔开,分别代表不同级别的域名。一般的格
式：`.... 三级域名.二级域名.顶级域名 `， 每一级的域名都由**英文字母 **和 **数字**组成；**不超过**
**63字符且不区分大小写字母；**级别**最低的域名写在最左边**，而级别最高的**顶级域名写在最右边**；完
整的域名**不超过255个字符。**
注意：

- 域名系统既**不规定一个域名需要包含多少个下级域名,**也**不规定每一级的域名代表什么意思。**
- 各级域名由**其上一级的域名管理机构管理**，而最高的**顶级域名**则由**因特网名称与数字地址分配机构ICANN**进行管理。

**顶级域名分类：**

- **国家顶级域名nTLD** (采用ISO 3166的规定)
   - 如cn表示中国，us表示美国，uk表示英国、等等。
- **通用项级域名gTLD**
   -  常见的  com (公司企业)、net (网络服务机构)、org (非营利性组织)、int (国际组织)、edu (美国教育结构)、gov (美国政府部门)、mil (美国军事部门)。
- **反向域 arpa**      用于反向域名解析，即IP地址反向解析为域名。

**注意：**

- **国家顶级域名下**注册的**二级域名**均由**该国家自行确定**
- 我国则将二级域名划分为以下**两类**:
   - **类别域名** ** 9个** ac (科研机构)、com (工、商、金融等企业)、edu (教育机构)、gov (政府部门)、net (提供网络服务的机构)、mil (军事机构)和org (非利性组织)。
   - **行政区域名** **34个**，适用于我国的各省、自治区、直辖市。例如: bj为北京市、sh为. 上海市、js为江苏省，等等.
- 因为不对 顶级域名下的 二级域名做名称规定，所以是会有可能重名的

域名示意图
![image.png](https://cdn.nlark.com/yuque/0/2024/png/39240021/1704878598122-782a597a-bead-4b56-8015-c380e92b99d5.png#averageHue=%23f1eff1&clientId=uc832c70b-b544-4&from=paste&height=297&id=ucecce108&originHeight=556&originWidth=1548&originalType=binary&ratio=1.875&rotation=0&showTitle=false&size=282139&status=done&style=stroke&taskId=u5ac06d36-a450-423c-841c-d14c175449a&title=&width=825.6)
### 域名服务器
域名和IP地址的映射关系必须保存在  **域名服务器 **中, 供所有其他应用查询。显然不能将所有
信息都储存在一台域名服务器中。DNS使用 **分布在各地的域名服务器** 来实现域名到IP地址的转换
**域名服务器**可以划分为以下**四种**不同的类型: 

- 根域名服务器 
   - 是**最高层次**的域名服务器。每个`根域名服务器`都知道**所有的** `**顶级域名服务器**`**的域名及其IP地址 **，因特网上共有**13**个 不同IP地址的 `根域名服务器`。尽管我们将这13个根域名服务器中的每一个都视为单个的服务器但 "每台服务器" 实际上是 **由许多分布在世界各地的计算机构成的 服务器群集**。当`本地域名服务器`向`根域名服务器` 发出**查询请求时**， 路由器 就把询请求报文转发到离这个DNS客户**最近**的一个**根域名服务器**，这就加快了DNS的查询过程，同时也更合理地利用了因特网的资源。`根域名服务器` 通常并 不直接 对域名进行解析，而是 返回该域名所属 顶级域名的`顶级域名服务器`的IP地址。
- 顶级域名服务器 
   - 这些域名服务器 负责 **管理在该**`**顶级域名服务器**`** 注册的所有 二级域名**。当收到DNS查询请求时就给出相应的回答 (可能是 **最后的结果**，也可能是**下一级 **`**权限域名服务器**`的IP地址)。
- 权限域名服务器 
   - 这些域名服务器 **负责管理 某个区 的域名**。**每一个主机的域名 **都必须在 某个 权限域名服务器处 **注册登记**。因此`权限域名服务器` 知道 其管辖的域名 与 IP地址 的**映射关系**。另外`**权限域名服务器**`还 知道 其下级域名服务器的**地址**。
- 本地域名服务器
   - 本地域名服务器 **不属于 上述的域名服务器的等级结构**。当一个主机发出DNS请求报文时，这个报文就首先被送往**该主机的**`**本地域服务器**`。本地域名服务器起着 **代理 **的作用，会将该报文转发到上述的域名服务器的等级结构中。每一个因特网服务提供者ISP, 一个大学，甚至一个大学里的学院，都可以拥有一个本地域名服务器，它有时也称为 `**默认域名服务器**`。本地域名服务器离用户较近，一般不超过几个路由器的距离，也有可能就在同一个局域网中。注意：`**本地域名服务器**`** 的IP地址 **需要 直接配置 在**需要域名解析**的 **主机 **中。
### 域名解析的过程
域名解析其实就是向服务器请求之后，服务器的查询工作方式 ，可以分成两种 ： 递归查询 + 
迭代查询。
**递归查询**
所谓递归查询其实就是  主机 向 本地域名服务器进行递归请求查询  之后 本地域名服务器 也
采用 递复查询 的方式向 某个 根域名服务器查询， 之后 根域名服务器 同样采用 递复查询 的方式
向 某个 顶级域名服务器查询 同样的  顶级域名服务器  也采用 递归查询 的方式向 某个 权限域名服
务器查询 最后 权限域名服务器 返回结果 结果依次在服务器中传递 最后返回主机中。(这就好比  (主机)A ->B(本地ymfwq)  然后B->C(根ymfwq) C-> D(顶级ymfwq) D->E(权限ymfwq) 最后E返回结果到D D->C  C->B B->A   )
**迭代查询**
迭代查询 则是指 主机首先向 本地域名服务器进行递归查询，本地域名服务器 采用 迭代查询
它先向某个根域名服务器查询，根域名服务器 告诉 本地域名服务 下一次应查询的顶级域名服务器
地址，然后本地域名服务器 将会找寻  顶级域名服务器 查询 同样的  顶级域名服务器 告诉 本地域
名服务 下一次应查询 权限域名服务器 ，最后 本地域名服务器 请求   权限域名服务器 得到结果。
(A->B B->C C->B B->D D->B B->E E->B 最后 B->A)
注意：

- 由于递归查询对于被查询的域名服务器负担太大，通常采用以下模式:**主机到本地域名服务器是递归查询，而其余的查询是迭代查询。**
### 域名缓存
为了提高DNS的**查询效率**，并**减轻 **根域名服务器 的**负荷** 和**减少**因特网上的DNS查询报文**数**
**量**，在域名服务器中广泛地使用了**高速缓存**。高速缓存用来 存放 最近查询过的域名 以及 从何处获
得域名映射信息的记录。由于 域名到IP地址的映射关系**并不是永久不变**，为保持高速缓存中的内容
正确，域名服务器应为每项内容设置**计时器并删除**超过合理时间的项(比如两天定期删除)
不但在本地域名服务器中需要高速缓存，在**用户主机中**也很需要。许多用户主机在启动时从本
地域名服务器下载域名和IP地址的全部数据库，维护存放自己最近使用的域名的高速缓存，并且只
在从缓存中找不到域名时才向域名服务器查询。同理，主机也需要保持高速缓存中内容的正确性。
## 6.2文件传输 FTP
文件传送协议FTP (File Transfer Protocol)是因特网上使用得最广泛的文件传送协议（只不过
后来 万维网WWW的通信量 超过了FTP),FTP提供** 交互式** 的访问，允许客户 **指明文件的类型**与**格**
**式 **(如指明是否使用ASCII码) , **并允许文件具有存取权限**(如访问文件的用户必须经过授权，并输入
有效的口令)。** FTP屏蔽了各计算机系统的细节，因而适合于在异构网络中任意计算机之间传送文**
**件。** FTP采用** C/S 的模式**  选用一台服务器作为FTP服务器 ，用户可以**上传文件**到该服务器上，当
然也可以从此服务器上**下载文件**。 它是基于TCP的

- 在**计算机上创建FTP服务器**,可以使用**第三方的FTP服务器软件** 或者 **使用操作系统**自带的FTP服务器软件。
- **访问**可以**通过浏览器使用ftp协议**  或者使用 **操作系统的命令行方式**  或者 **第三方的软件**

工作原理示意图
![image.png](https://cdn.nlark.com/yuque/0/2024/png/39240021/1704884280436-f37c5f7d-b518-413e-99e9-bbc8febd8a2c.png#averageHue=%23ebb18b&clientId=uc832c70b-b544-4&from=paste&height=418&id=Th3ur&originHeight=783&originWidth=1573&originalType=binary&ratio=1.875&rotation=0&showTitle=false&size=936605&status=done&style=stroke&taskId=ud7142bc6-7bff-47d2-927a-5b467f09f21&title=&width=838.9333333333333)

## 6.3动态主机配置协议 DHCP
我们已经知道想要进行网络通信 那么就**一定要遵守相关的协议**(IP协议 Http等)  然后**做好相关**
**配置**后(比如：IP地址 子网掩码  网关地址 ，DNS地址等) 才能与其他主机进行 **信息交互**。如果在
计算机出厂前就配置好显然是不可行的，比如IP地址是有网络号的 实现并不知道网络号是多少，所
以需要用户自己配置，但是每次进行通信前都要自己配置也很麻烦，所以 动态主机配置 DHCP就
产生了。 它是基于UDP的。
DHCP也是 C/S模式的 (基于UDP)， DHCP客户端 UDP端口 68 而DHCP服务器UDP 端口 67 ** 首先** 在主机开机的时候会启动DHCP服务   使用广播的形式 先查询 DHCP服务器位置(因为没有IP 
所以源IP 为全0 使用广播 目的IP 全1 但是该报文中有能够标识自己的** 事务I**D) ,虽然所有主机都能
收到广播但是只有 启动着67端口的 DHCP服务器能够解析到 广播数据(  其余主机会丢弃该报文) 
**然后 **DHCP服务器会先查找数据库 如果找到该主机的配置就封装到数据报中， 找不到就分配一个
地址(会进行IP分析保证不会冲突  ARP)后封装  ，**回送响应报文**(此时**任然使用广播** ，因为客户机
还没有IP地址，但是**基于事务ID** 客户机可以收到) 客户端收到后再次检测该配置信息是否可用(比如
运行 ARP协议)  由于可能会有多个DHCP服务器发来的数据 随机选择一个即可 然后再次广播 发送
请求数据报 ，之后 DHCP 回送广播的响应数据报 至此 客户机就可以完成了一系列的相关配置。
示意图
![image.png](https://cdn.nlark.com/yuque/0/2024/png/39240021/1704957539301-0f95ecf0-5e96-43fb-948d-76d70395543c.png#averageHue=%23eadcaf&clientId=u3584b6ba-183e-4&from=paste&height=455&id=u3a2fa115&originHeight=854&originWidth=1681&originalType=binary&ratio=1.875&rotation=0&showTitle=false&size=1036812&status=done&style=stroke&taskId=ua4043cd9-9c74-469b-9a4e-ba6ee787c86&title=&width=896.5333333333333)
注意：

- 在正式使用 配置之前 客户机和服务机 一直使用 广播  进行通信
- **DHCP DISCOVER** 报文中封装着 **能够标识自己的  事务ID  **
- **DHCP OFFER**  中则是也是有事务ID (让客户机知道这是给自己的数据)  和一些配置数据(ip mask getway  dns等)  此时的配置数据 也是要通过ARP 进行检验的的
- **DHCP REQUEST**  里面则是 进行确认的信息  一般可以封装 租用时间 等数据
- **DHCP ACK**    证明通过ARP 检测 可以使用 
- **DHCP REQUEST**   也可用于延长租用期 在0.5t的时候发送
- **DHCP NACK  **  用于服务端  禁止 客户机 使用配置信息  此时客户机将会立即停止使用该配置
- **DHCP RELEASE  **  客户端和服务端解除 配置的使用
- **中继代理器 ** :  有时候我们不会在每一个网络上都设置一个DHCP服务器 ，因此我们会给相关的路由器 设置 DHCP的IP地址 这样当它收到DHCP的广播后就能够将信息传递给 DHCP服务以便完成后续工作。
## 6.3 电子邮件 
考虑到传统的电话(实时通信)的缺点：(双方必须同时在场，实时的要求限制人们时间等）电子
邮件(E-mail)就诞生了。它是因特网上 最早 流行的一种应用，在现在仍然是比较重要的应用 ，它
使用方便、传输迅速而且内容多样(图片，视频) 逐步取代了一些电报业务。
### 工作过程
电子邮件使用** C/S** 架构 ，电子邮件系统有三大构件 ：

- **用户代理**      (用户与电子邮件系统的接口，又称为电子邮件**客户端软件，**它完成push工作)
- **邮件服务器**  (是电子邮件系统的基础设施，主要用于** 发送和接收 邮件** 同时 **维护用户的邮箱)**
- **相关协议**（则是在传输过程中的一些协议  邮件发送协议 +  邮件读取协议  ）。

通信双方 A B 都有**自己对应的邮件服务器**，当进行通信的时候 A 会把邮件发送到自己的邮件
**服务器上(又称为 “推 push”) ，然后 自己的邮件服务器发送信息 回会直接抵达 对方的 邮件服**
**务器，最后B从自己邮件服务器上 下载邮件信息(又称 “拉pull”)。**
![image.png](https://cdn.nlark.com/yuque/0/2024/png/39240021/1704951218612-79f9d8bd-662b-41e6-b376-f5534cc92679.png#averageHue=%23f2eceb&clientId=u3584b6ba-183e-4&from=paste&height=298&id=Yrvm2&originHeight=399&originWidth=829&originalType=binary&ratio=1.875&rotation=0&showTitle=false&size=202106&status=done&style=stroke&taskId=u228c1fb1-fd51-4cf7-8a89-392fe0704c1&title=&width=618.1333618164062)
![image.png](https://cdn.nlark.com/yuque/0/2024/png/39240021/1704951302265-ac07f326-26ef-4d23-a6eb-8f7e0b019f6b.png#averageHue=%23f0d5b7&clientId=u3584b6ba-183e-4&from=paste&height=397&id=ScWgn&originHeight=744&originWidth=1658&originalType=binary&ratio=1.875&rotation=0&showTitle=false&size=963221&status=done&style=stroke&taskId=ua7eaae83-d964-44cb-bb20-42ed21d7f4c&title=&width=884.2666666666667)

注意：

- 整个过程对用户来说是不透明的，用户只是觉得好像自己的信息直接发送给了目的方
- 发送过程中使用的是 ** 端口 25**
- "推"的过程涉及** 邮件发送协议 SMTP ** "拉"的过程 涉及 邮件读取协议 (比如 POP3 | IMAP)
- ”推和拉“的过程是由程序自动完成 不需要用户干涉
- 在**两个服务器之间**的传输是  **直达的** ，也就是说直接交付而不是经过其他路由器转发
### 信息格式
电子邮件的信息格式并不是由SMTP定义的，而是在RFC 822中单独定义的。这个RFC文档已在2008年更新为RFC 5322。一个电子邮件有 **信封 **和 **内容**两部分。而内容又由 **首部 **和 **主体**两部分构成。
![image.png](https://cdn.nlark.com/yuque/0/2024/png/39240021/1704951459998-0dde823a-f272-433a-972b-b28925938e72.png#averageHue=%23e8e5e2&clientId=u3584b6ba-183e-4&from=paste&height=342&id=QGFis&originHeight=642&originWidth=1368&originalType=binary&ratio=1.875&rotation=0&showTitle=false&size=430586&status=done&style=stroke&taskId=uf50cac9a-7664-45df-8404-77a4299095f&title=&width=729.6)
### 相关协议
整个通信过程时使用到了**两大类**协议的 ： **邮件发送协议** SMTP  + **邮件读取协议**(POP| 
IMAP),邮件发送协议在”推“ 和运输的过程中都在使用，而邮件读取协议仅仅子啊“拉”的时候
会使用。
**邮局协议POP** (Post Office Protocol)，POP3是其第三个版本，是因特网正式标准。非常简
单、功能有限的邮件读取协议。用户只能以**下载并删除**方式或下载并保留方式从邮件服务器下载邮
件到用户方计算机。**不允许用户在邮件服务器上管理自己的邮件**。(例如创建文件夹, 对邮件进行分类管理等)。
**因特网邮件访问协议IMAP** (Internet Message Access Protocol) , IMAP4是其第四个版本，
目前还只是因特网建议标准。功能比POP3强大的邮件读取协议。用户在自己的计算机上就可以操
控邮件服务器中的邮箱，就像在本地操控一样，因此IMAP是一个联机协议。
POP3和IMAP4都采用基于**TCP连接的客户/服务器方式**。POP3 使用熟知 **端口110**, IMAP4使
用熟知**端口143。**
### 通用拓展协议 MIME
SMTP协议**只能传送ASCII码文本数据**，不能传送可执行文件或其他的二进制对象。SMTP不能
满足**传送多媒体邮件**(比如带有 图片 视频)的需要，并且许多其他非英语国家的文字(比如 中文等)也
无法用SMTP传送。为解决SMTP传送非ASCII码文本的问题，提出了 **多用途因特网邮件扩展**
**MIME (Multipurpose Internet Mail Extensions)。**MIME通过  **定义了传送编码**，可对任何内容格式进行转换，而不会被邮件系统改变**定义了许多邮件内容的格式**，对多媒体电子邮件的表示方法进行了标准化。
![image.png](https://cdn.nlark.com/yuque/0/2024/png/39240021/1704951635045-1f7be41b-89e9-4e41-bea9-03b951279fa5.png#averageHue=%23f6f3ed&clientId=u3584b6ba-183e-4&from=paste&height=276&id=KaW81&originHeight=518&originWidth=1114&originalType=binary&ratio=1.875&rotation=0&showTitle=false&size=243520&status=done&style=stroke&taskId=u5276148d-c605-4394-acb1-6b32990fa8d&title=&width=594.1333333333333)
注意：

- 实际上，MIME不仅仅用于SMTP,也用于后来的同样面向ASCII字符的HTTP
### 电子邮件
通过**浏览器**登录(提供用户名和口令)邮件服务器万维网网站就可以撰写、收发、阅读和管理电
子邮件。这种工作模式与IMAP很类似，不同的是用户计算机无需安装专门的用户代理程序，只需
要使用通用的万维网浏览器。邮件服务器网站通常都提供非常强大和方便的邮件管理功能，用户可
以**在邮件服务器网站上管理和处理自己的邮件，而不需要将邮件下载到本地进行管理。**
![image.png](https://cdn.nlark.com/yuque/0/2024/png/39240021/1704952036778-5491eb4e-6137-4902-9bfb-d57cc0b0c716.png#averageHue=%23f2f0ef&clientId=u3584b6ba-183e-4&from=paste&height=221&id=Yb39Q&originHeight=414&originWidth=1510&originalType=binary&ratio=1.875&rotation=0&showTitle=false&size=384369&status=done&style=stroke&taskId=u90eed26b-6273-4544-ad7a-c9fadfcf55d&title=&width=805.3333333333334)
## 6.4 万维网 WWW
### 概述
首先 万维网WWW (World Wide Web) **并非**某种特殊的**计算机网络**。它其实是一个 **大规模**
**的、联机式 的 信息储藏所**, 是 **运行在因特网上 **的一个**分布式应用**。万维网 利用网页之间的**超链接**
将**不同网站的网页**链接成一张逻辑上的**信息网**。万维网 是一个 **超媒体 **的系统，它是对** 超文本 **的
扩充 ，(所谓的超文本就表示 并非普通的文本 之简单的通过文字记录内容 ，而是在文本中利用不
同的链接来获取不同位置的文本内容) , 超媒体则是说明 不仅仅是文本内容 还可以有其他 图片 影
视等资源。同样的 万维网也是 C/S 模式 是由客户端向服务器发出请求，服务器回送 客户端所要的
万维网文档，在一个客户端程序主体窗口上显示的万维网文档称为 **页面。**

- 万维网是 **欧洲粒子物理实验室的Tim Berners-Lee **最初于**1989年3月提出的。**
- **1993年2月**，**第一个图形界面的浏览器Mosaic** ,**1995**年著名的Netscape Navigator **网景浏览器上市。**
- **浏览器**最重要的部分是**渲染引擎**，也就是**浏览器内核**。负责对网页内容进行解析和显示。不同的浏览器内核对网页内容的解析也有不同，因此同一网页在不同内核的浏览器里的显示效果可能不同
### 统一资源定位符 URL
因为万维网上的资源分布在 **互联网各地** ，所以 **标识 **这些 万维网文档 就很重要，在万维网中
我们使用 **统一资源定位符 URL** 来**唯一标识 **万维网文档。它其实就相当于一个 **唯一指向的指针**，
但是由于访问对象使用的协议不同，所以URL还选哟指出读取该文档应该使用的协议。
URL的一般形式由以下四个部分组成 : ** <协议>: //<主机>:<端口>/<路径>**

- 协议 是指使用何种协议来获取该万维网文档 (最常使用的是** http** ftp)
- 主机名 就是存放万维网文档的**主机域名** 通常**使用 www开头** 但是**也可以使用IP地址**
- 端口  就是端口号 通常被省略掉(因为往往是默认端口 80 )   如果不使用默认端口就必须写上
- 路径   其实就是要访问的位置了 往往是比较长的字符串 (中间使用 “/”  隔开)

注意：

- 现在的浏览器 为了输入方便  一般是可以 直接输入 域名 的 前面省略的部分有浏览器自动补全（比如 ： baidu.com）
### 超文本协议 HTTP
协议 HTTP 规定了 **浏览器**(万维网客户端)  怎样向 **服务器** 请求 万维网文档 ，以及服务器怎么
样把资源传递给浏览器 。 在浏览器个服务器请求和响应之间的**交互**，必须**按照一定的规则**和**格式**
这些规则和格式就是 **超文本协议HTTP的内容**。从层次上看 HTTP 是 **面向事务的** ，也就是说它能
够保障传输资源的**正确**和**完整性**。
每个 **服务器 **都有一个进程 在 不断的 **监听 TCP端口80** ，以便于发现 浏览器发出的建立链接
请求，一旦连接成功建立，浏览器就可以发出请求了，之后服务器返回响应的数据 ，服务器在**完成**
**任务之后 TCP连接才被释放 **。**HTTP协议**使用** 面向连接的TCP** 作为运输层协议 ，保证了运输的
可靠性，但是**HTTP 本身是无连接的**(也就是说 HTTP 先进行TCP连接  之后利用这个连接来传输资
源，而**HTTP本身不建立连接**) 。**HTTP 也是无状态的** (也就是说 服务器 不会记录是否再次为同一
个客户端 传输数据 这就简化了服务器的设计 ，说白了就是你要资源我就给你，我不用管你是谁，
是否曾经给你服务过)

- HTTP/1.0 采用**非持续连接**方式。在该方式下，每次浏览器要请求一个文件都要与服务器建立TCP连接,当收到响应后就立即关闭连接。每请求一个文档就要有两倍的RTT的开销。 若一个网页 上有很多引用对象 (例如图片等)，那么请求每一个对象都需要花费2RTT的时间。为了**减小时延，** 浏览器通常**会建立多个并**行的TCP连接同时请求多个对象。但是，这会大量占用万维网服务器的资源，特别是万维网服务器往往要同时服务于大量客户的请求,这会使其负担很重。
- HTTP/1.1采用**持续连接方式**。在该方式下，**万维网服务器在发送响应后仍然保持这条连接**，使同-一个客户(浏览器)和该服务器可以继续在这条连接.上传送后续的HTTP请求报文和响应报文。这并不局限于传送同一个页面上引用的对象，而是只要这些文档都在同一个服务器上就行。
- 为了进一 步提高效率, HTTP/1.1 的持续连接还可以使用**流水线方式工作**，即浏览器在**收到响应报文之前就能够连续发送多个请求报文**。这样的一个接一个的请求报文到达服务器后，服务器就发回一个接一个的响应报文。这样就节省了很多个RTT时间，使TCP连接中的空闲时间减少，提高了下载文档的效率。

**报文格式**
HTTP是面向文本的，其报文中的**每一个字段**都是**一些ASCII码串**，并且每个字段的**长度都是不确定的。**
请求报文格式![image.png](https://cdn.nlark.com/yuque/0/2024/png/39240021/1704944851701-a33e6bde-f88f-4934-9650-6f0dfb3e2e30.png#averageHue=%23ebe8e8&clientId=u3584b6ba-183e-4&from=paste&height=316&id=u8f4f6111&originHeight=593&originWidth=1594&originalType=binary&ratio=1.875&rotation=0&showTitle=false&size=424506&status=done&style=stroke&taskId=ue4a741aa-1664-4fc8-ad5b-985c58eb9be&title=&width=850.1333333333333)
响应报文格式
![image.png](https://cdn.nlark.com/yuque/0/2024/png/39240021/1704945013877-40f0ba0b-cb06-488d-9374-63092a7e9635.png#averageHue=%23f1efef&clientId=u3584b6ba-183e-4&from=paste&height=283&id=udd835c86&originHeight=530&originWidth=1526&originalType=binary&ratio=1.875&rotation=0&showTitle=false&size=195575&status=done&style=stroke&taskId=uac09b67b-ae5b-43b9-bfff-d0fe79e95a3&title=&width=813.8666666666667)

**缓存 cookie**
因为 HTTP是无状态的，所以无法记录用户的任何信息，但是有时候人们又想要去记录使用者的一些活动轨迹(请求历程) 为此cookie诞生了 (Cookie是一种对无状态的HTTP进行状态化的技术)
具体的工作流程是 ： 当浏览器**第一次**访问**某个网站**(服务器)时候 ，服务器会在为此客户机设置一个** 唯一的Cookie识别码** ，并在服务器后台设置一个库专门维护用户访问该网站的各种信息，网站在 **响应报文的首部 **中回写入 set-cookie :值 ，当浏览器接收到该响应报文后 就会在本机上自动建立一个文件存储 **该服务器域名**和 **cookie码**，此后在**该网站的每一次请求报文首部行中都附带该cookie码，以便于服务器记录信息。**
### 缓存与代理服务器
在万维网中还可以使用 **缓存机制 **以提高万维网的效率。万维网缓存又称为**Web缓存(Web **
**Cache)**，可位于**客户机(浏览器中)**，也可位于**中间系统上(代理服务器(Proxy Server))**。Web缓
存把最近的一些请求和响应暂存在本地磁盘中。当新请求到达时，若发这个请求与暂时存放的请求
相同，就返回暂存的响应，而不需要按URL的地址再次去因特网访问该资源(这就大大减少了网络上
的通信量进而提升带宽减少时延) 。同样的 代理服务器也要面临 **资源更新的问题** ， 往往在资源的
首部回会社有相关字段来标志着该资源是否过期，如果过期就需要重新请求服务器进行更新。
大致示意图
![image.png](https://cdn.nlark.com/yuque/0/2024/png/39240021/1704946565065-360e8959-15fe-4fb2-9113-d125cfd814d6.png#averageHue=%23f0dac7&clientId=u3584b6ba-183e-4&from=paste&height=253&id=ue31097bb&originHeight=475&originWidth=1561&originalType=binary&ratio=1.875&rotation=0&showTitle=false&size=521822&status=done&style=stroke&taskId=udeef5d7b-0085-4e90-ada4-261a1791545&title=&width=832.5333333333333)
# 结语
整个 计算机网络 第八版    到这里就算基本基本结束了(可能每个人需要学习的部分不同，我们学校只考前六章基础知识，所以我也就只写了前六章 如果后面有时间我也会继续更新的 不过可能性不太大)，我感觉 整个部分中最难理解的就是第四章 的网络层 ，大家可以多看几遍  。最后我想说的就是 如果对你有帮助记得点个赞哈~~~
最后附上 课后习题的答案 ：
[https://blog.csdn.net/qq_51344334/category_10700545.html](https://blog.csdn.net/qq_51344334/category_10700545.html)

